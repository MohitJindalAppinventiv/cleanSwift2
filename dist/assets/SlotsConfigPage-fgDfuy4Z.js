import{c as ne,M as Ge,r as c,j as e,Q as ie,S as Je,aD as Ye,a as M,b as Ke,J as R,s as oe,v as V,aE as Qe,aF as ce,aG as Xe,aH as B,aI as Ze,aJ as es,d as ss,aK as ts,aL as se}from"./index-ByY07t5U.js";import{P as as,U as rs,D as ls}from"./DashboardLayout-CorAQK4x.js";import{b as de,B as w}from"./button-DBciqQcI.js";import{C as ns}from"./date-range-picker-CI4bxXt7.js";import{S as J,a as Y,b as K,c as Q,d as H}from"./select-DSUhFaX8.js";import{C as me,a as xe,c as ue,b as is}from"./card-DrHBsbjm.js";import{B as te}from"./badge-B45milNp.js";import{S as os}from"./switch-C1bv9KX7.js";import{f as he,g as cs,O as ds,W as ms,C as xs,h as us,i as hs,j as pe,R as ps,P as gs,D as ge,a as fe,b as je,c as ve,T as fs}from"./dialog-DND4cV_M.js";import{I as P}from"./input-DcxO3ESS.js";import{L as A}from"./label-CtRxIZG0.js";import{S as D}from"./skeleton-D-G3Wgw9.js";import{C as G}from"./circle-alert-DAgzbPCO.js";import{C as ae}from"./calendar-DaBMcz2l.js";import{T as js}from"./truck-D4vkvwy8.js";import{L as Ne}from"./loader-circle-CHQfb1Hg.js";import{C as vs}from"./circle-check-BwmQp1B-.js";import{C as Ns}from"./clock-DBwSQnl3.js";import{P as bs}from"./pencil-DXUm_KnJ.js";import{P as ys}from"./plus-DsKVMYgt.js";import"./popover-C7cgABi1.js";import"./chevron-left-BFqG9IJl.js";import"./chevron-right-Nhb4I_UE.js";import"./Combination-DHf6tu9R.js";import"./index-Dxwkp90n.js";import"./index-DjrpyVfh.js";import"./index-DDlNMbpf.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=ne("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ts=ne("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);var be="AlertDialog",[Ds,pt]=Ge(be,[he]),O=he(),ye=r=>{const{__scopeAlertDialog:n,...s}=r,i=O(n);return e.jsx(ps,{...i,...s,modal:!0})};ye.displayName=be;var ws="AlertDialogTrigger",Ss=c.forwardRef((r,n)=>{const{__scopeAlertDialog:s,...i}=r,d=O(s);return e.jsx(cs,{...d,...i,ref:n})});Ss.displayName=ws;var Cs="AlertDialogPortal",Te=r=>{const{__scopeAlertDialog:n,...s}=r,i=O(n);return e.jsx(gs,{...i,...s})};Te.displayName=Cs;var As="AlertDialogOverlay",De=c.forwardRef((r,n)=>{const{__scopeAlertDialog:s,...i}=r,d=O(s);return e.jsx(ds,{...d,...i,ref:n})});De.displayName=As;var U="AlertDialogContent",[Rs,Os]=Ds(U),we=c.forwardRef((r,n)=>{const{__scopeAlertDialog:s,children:i,...d}=r,g=O(s),p=c.useRef(null),j=ie(n,p),h=c.useRef(null);return e.jsx(ms,{contentName:U,titleName:Se,docsSlug:"alert-dialog",children:e.jsx(Rs,{scope:s,cancelRef:h,children:e.jsxs(xs,{role:"alertdialog",...g,...d,ref:j,onOpenAutoFocus:Je(d.onOpenAutoFocus,v=>{var u;v.preventDefault(),(u=h.current)==null||u.focus({preventScroll:!0})}),onPointerDownOutside:v=>v.preventDefault(),onInteractOutside:v=>v.preventDefault(),children:[e.jsx(Ye,{children:i}),e.jsx(Es,{contentRef:p})]})})})});we.displayName=U;var Se="AlertDialogTitle",Ce=c.forwardRef((r,n)=>{const{__scopeAlertDialog:s,...i}=r,d=O(s);return e.jsx(us,{...d,...i,ref:n})});Ce.displayName=Se;var Ae="AlertDialogDescription",Re=c.forwardRef((r,n)=>{const{__scopeAlertDialog:s,...i}=r,d=O(s);return e.jsx(hs,{...d,...i,ref:n})});Re.displayName=Ae;var ks="AlertDialogAction",Oe=c.forwardRef((r,n)=>{const{__scopeAlertDialog:s,...i}=r,d=O(s);return e.jsx(pe,{...d,...i,ref:n})});Oe.displayName=ks;var ke="AlertDialogCancel",Ee=c.forwardRef((r,n)=>{const{__scopeAlertDialog:s,...i}=r,{cancelRef:d}=Os(ke,s),g=O(s),p=ie(n,d);return e.jsx(pe,{...g,...i,ref:p})});Ee.displayName=ke;var Es=({contentRef:r})=>{const n=`\`${U}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${U}\` by passing a \`${Ae}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${U}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return c.useEffect(()=>{var i;document.getElementById((i=r.current)==null?void 0:i.getAttribute("aria-describedby"))||console.warn(n)},[n,r]),null},Ms=ye,$s=Te,Me=De,$e=we,Pe=Oe,_e=Ee,Ie=Ce,Fe=Re;const Ps=Ms,_s=$s,Le=c.forwardRef(({className:r,...n},s)=>e.jsx(Me,{className:M("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...n,ref:s}));Le.displayName=Me.displayName;const He=c.forwardRef(({className:r,...n},s)=>e.jsxs(_s,{children:[e.jsx(Le,{}),e.jsx($e,{ref:s,className:M("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...n})]}));He.displayName=$e.displayName;const Ue=({className:r,...n})=>e.jsx("div",{className:M("flex flex-col space-y-2 text-center sm:text-left",r),...n});Ue.displayName="AlertDialogHeader";const ze=({className:r,...n})=>e.jsx("div",{className:M("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",r),...n});ze.displayName="AlertDialogFooter";const We=c.forwardRef(({className:r,...n},s)=>e.jsx(Ie,{ref:s,className:M("text-lg font-semibold",r),...n}));We.displayName=Ie.displayName;const Ve=c.forwardRef(({className:r,...n},s)=>e.jsx(Fe,{ref:s,className:M("text-sm text-muted-foreground",r),...n}));Ve.displayName=Fe.displayName;const qe=c.forwardRef(({className:r,...n},s)=>e.jsx(Pe,{ref:s,className:M(de(),r),...n}));qe.displayName=Pe.displayName;const Be=c.forwardRef(({className:r,...n},s)=>e.jsx(_e,{ref:s,className:M(de({variant:"outline"}),"mt-2 sm:mt-0",r),...n}));Be.displayName=_e.displayName;function Is({open:r,onClose:n,slot:s,onUpdated:i}){const[d,g]=c.useState(""),[p,j]=c.useState(""),[h,v]=c.useState(1),[u,b]=c.useState(!1),[f,S]=c.useState({});c.useEffect(()=>{s&&(g(s.startTime),j(s.endTime),v(s.maxOrders),S({}))},[s]);const k=(t,x)=>{if(!t||!x)return 0;const N=new Date(`2000-01-01T${t}`),y=new Date(`2000-01-01T${x}`);return y<=N&&y.setDate(y.getDate()+1),(y.getTime()-N.getTime())/(1e3*60*60)},E=t=>{if(t===0)return"";const x=Math.floor(t),N=Math.round((t-x)*60);return N===0?`${x} hour${x!==1?"s":""}`:`${x}h ${N}m`},z=()=>{const t={};let x=!1;if(d.trim()||(t.startTime="Start time is required",x=!0),p.trim()||(t.endTime="End time is required",x=!0),d&&p){const N=new Date(`2000-01-01T${d}`),y=new Date(`2000-01-01T${p}`);y<=N&&y.setDate(y.getDate()+1);const C=k(d,p);C>2&&(t.duration=`Duration cannot exceed 2 hours (current: ${E(C)})`,x=!0),C<.5&&(t.duration="Duration must be at least 30 minutes",x=!0)}return(!h||h<1)&&(t.maxOrders="Max orders must be at least 1",x=!0),h>100&&(t.maxOrders="Max orders cannot exceed 100",x=!0),s&&h<s.currentOrders&&(t.maxOrders=`Max orders cannot be less than current orders (${s.currentOrders})`,x=!0),S(t),!x},_=async()=>{if(s){if(!z()){R.error("Please fix the validation errors");return}b(!0);try{await Ke.put("/adminUpdateSlot",{startTime:d,endTime:p,maxOrders:h},{params:{slotId:s.id}}),R.success("Slot updated successfully"),n(),i()}catch{R.error("Failed to update slot")}finally{b(!1)}}},T=t=>{f[t]&&S(x=>{const N={...x};return delete N[t],N})},I=t=>{g(t),T("startTime"),T("duration"),T("timeRange")},F=t=>{j(t),T("endTime"),T("duration"),T("timeRange")},L=t=>{const x=t===""?1:Number(t);v(x),T("maxOrders")},a=t=>{t.target.select()},l=k(d,p),o=l>0?E(l):"",m=l>0&&l<=2;return e.jsx(ge,{open:r,onOpenChange:n,children:e.jsxs(fe,{className:"max-w-md",children:[e.jsx(je,{children:e.jsx(ve,{children:"Update Slot"})}),e.jsxs("div",{className:"space-y-4",children:[s&&e.jsxs("div",{className:"bg-slate-50 p-3 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-slate-600 mb-1",children:[e.jsx("strong",{children:"Type:"})," ",s.type.charAt(0).toUpperCase()+s.type.slice(1)]}),e.jsxs("p",{className:"text-sm text-slate-600 mb-1",children:[e.jsx("strong",{children:"Date:"})," ",new Date(s.date).toLocaleDateString()]}),e.jsxs("p",{className:"text-sm text-slate-600",children:[e.jsx("strong",{children:"Current Orders:"})," ",s.currentOrders]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Start Time"}),e.jsx(P,{type:"time",value:d,onChange:t=>I(t.target.value),className:f.startTime?"border-red-500":""}),f.startTime&&e.jsx("p",{className:"text-red-500 text-xs",children:f.startTime})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"End Time"}),e.jsx(P,{type:"time",value:p,onChange:t=>F(t.target.value),className:f.endTime?"border-red-500":""}),f.endTime&&e.jsx("p",{className:"text-red-500 text-xs",children:f.endTime})]}),o&&e.jsx("div",{children:e.jsxs("div",{className:`text-xs px-3 py-2 rounded-md inline-block ${m?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"}`,children:[e.jsx("strong",{children:"Duration:"})," ",o,l>2&&" (exceeds 2-hour limit)"]})}),f.duration&&e.jsx("p",{className:"text-red-500 text-xs",children:f.duration}),f.timeRange&&e.jsx("p",{className:"text-red-500 text-xs",children:f.timeRange}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Max Orders"}),e.jsx(P,{type:"number",min:"1",max:"100",value:h,onChange:t=>L(t.target.value),onFocus:a,className:f.maxOrders?"border-red-500":""}),f.maxOrders&&e.jsx("p",{className:"text-red-500 text-xs",children:f.maxOrders}),s&&s.currentOrders>0&&e.jsxs("p",{className:"text-xs text-amber-600",children:["Note: This slot currently has ",s.currentOrders," active orders"]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(w,{onClick:_,disabled:u||!m,className:"flex-1",children:u?"Updating...":"Update Slot"}),e.jsx(w,{variant:"outline",onClick:n,disabled:u,children:"Cancel"})]})]})]})})}function Fs(){return e.jsx("div",{className:"space-y-6",children:Array.from({length:2}).map((r,n)=>e.jsxs(me,{className:"rounded-lg shadow-sm",children:[e.jsx(xe,{className:"bg-white border-b border-slate-200 pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(D,{className:"w-10 h-10 rounded-lg"}),e.jsxs("div",{children:[e.jsx(D,{className:"h-4 w-48 mb-2"}),e.jsx(D,{className:"h-3 w-24"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(D,{className:"h-4 w-12"}),e.jsx(D,{className:"h-4 w-12"})]})]})}),e.jsx(ue,{className:"p-6",children:e.jsx("div",{className:"grid lg:grid-cols-2 gap-8",children:["Pickup Slots","Delivery Slots"].map((s,i)=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 pb-2 border-b border-slate-200",children:[e.jsx(D,{className:"w-4 h-4"}),e.jsx(D,{className:"h-4 w-32"})]}),Array.from({length:2}).map((d,g)=>e.jsxs("div",{className:"border rounded-lg p-4 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx(D,{className:"h-4 w-32"}),e.jsx(D,{className:"h-5 w-16"})]}),e.jsx(D,{className:"h-3 w-full mb-2"}),e.jsx(D,{className:"h-3 w-20 mb-2"}),e.jsx(D,{className:"h-2 w-full rounded-full"})]},g))]},i))})})]},n))})}const Ls=(r,n)=>r.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),q=r=>{if(!r)return"";const[n,s]=r.split(":");let i=parseInt(n,10);const d=parseInt(s,10),g=i>=12?"PM":"AM";return i=i%12||12,`${i}:${d.toString().padStart(2,"0")} ${g}`};function Hs({type:r,dateRange:n}){const s=oe(),i=V(Qe),d=V(ce),g=V(Xe),[p,j]=c.useState(null),[h,v]=c.useState(null),[u,b]=c.useState(!1),[f,S]=c.useState(null),[k,E]=c.useState(null);c.useEffect(()=>{s(B({type:r,dateRange:n}))},[s,r,n]),c.useEffect(()=>{if(g){const a=setTimeout(()=>{s(Ze())},5e3);return()=>clearTimeout(a)}},[g,s]);const z=async a=>{try{S(a),await s(es(a)).unwrap(),j(null),R.success("Slot deleted successfully")}catch(l){ss.isAxiosError(l)?R.error(l.message):R.error("Failed to delete slot.")}finally{S(null)}},_=async a=>{try{E(a),await s(ts(a)).unwrap()}catch(l){console.error("Failed to toggle slot:",l),R.error("Failed to toggle slot status")}finally{E(null)}},T=()=>{s(B({type:r,dateRange:n}))},I=a=>Math.round(a.currentOrders/a.maxOrders*100),F=a=>a>=90?"bg-red-500":a>=70?"bg-amber-500":a>=40?"bg-blue-500":"bg-green-500",L=a=>a>=90?{color:"text-red-600",icon:G,label:"High"}:a>=70?{color:"text-amber-600",icon:re,label:"Medium"}:a>=40?{color:"text-blue-600",icon:re,label:"Low"}:{color:"text-green-600",icon:vs,label:"Available"};return g?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 space-y-4",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(G,{className:"w-8 h-8 text-red-600"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-red-600 mb-2",children:"Error Loading Slots"}),e.jsx("p",{className:"text-slate-600 max-w-md",children:g}),e.jsx(w,{onClick:()=>s(B({type:r,dateRange:n})),className:"mt-4",variant:"outline",children:"Try Again"})]})]}):d?e.jsx(Fs,{}):Object.keys(i).length===0?e.jsxs("div",{className:"text-center py-20",children:[e.jsx("div",{className:"w-24 h-24 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(ae,{className:"w-12 h-12 text-slate-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-slate-700 mb-2",children:"No slots found"}),e.jsx("p",{className:"text-slate-500 max-w-md mx-auto",children:"No slots match your current filters. Try adjusting your date range or slot type."})]}):e.jsxs("div",{className:"space-y-6",children:[Object.entries(i).map(([a,l])=>{const o=l.filter(t=>t.type==="pickup"),m=l.filter(t=>t.type==="delivery");return e.jsxs(me,{className:"rounded-lg shadow-sm hover:shadow-md transition-all duration-200",children:[e.jsx(xe,{className:"bg-white border-b border-slate-200 pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-50 rounded-lg flex items-center justify-center",children:e.jsx(ae,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx(is,{className:"text-lg font-semibold text-slate-900",children:Ls(new Date(a))}),e.jsxs("p",{className:"text-sm text-slate-500",children:[l.length," slot",l.length!==1?"s":""," ","scheduled"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-slate-600",children:[o.length>0&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold",children:o.length}),e.jsx("div",{className:"uppercase",children:"Pickup"})]}),m.length>0&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold",children:m.length}),e.jsx("div",{className:"uppercase",children:"Delivery"})]})]})]})}),e.jsx(ue,{className:"p-6",children:e.jsxs("div",{className:"grid lg:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 pb-2 border-b border-slate-200",children:[e.jsx(as,{className:"w-4 h-4 text-emerald-600"}),e.jsx("h3",{className:"font-medium text-slate-800",children:"Pickup Slots"})]}),o.length>0?o.map(t=>e.jsx(le,{slot:t,onEdit:()=>{v(t),b(!0)},onToggle:()=>_(t.id),onDelete:()=>j(t),getSlotUtilization:I,getUtilizationColor:F,getUtilizationStatus:L,isDeleting:f===t.id,isToggling:k===t.id},t.id)):e.jsx("p",{className:"text-sm text-slate-500 italic",children:"No pickup slots"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 pb-2 border-b border-slate-200",children:[e.jsx(js,{className:"w-4 h-4 text-blue-600"}),e.jsx("h3",{className:"font-medium text-slate-800",children:"Delivery Slots"})]}),m.length>0?m.map(t=>e.jsx(le,{slot:t,onEdit:()=>{v(t),b(!0)},onToggle:()=>_(t.id),onDelete:()=>j(t),getSlotUtilization:I,getUtilizationColor:F,getUtilizationStatus:L,isDeleting:f===t.id,isToggling:k===t.id},t.id)):e.jsx("p",{className:"text-sm text-slate-500 italic",children:"No delivery slots"})]})]})})]},a)}),e.jsx(Is,{open:u,onClose:()=>b(!1),slot:h,onUpdated:T}),e.jsx(Ps,{open:!!p,onOpenChange:()=>j(null),children:e.jsxs(He,{className:"max-w-md",children:[e.jsxs(Ue,{children:[e.jsxs(We,{className:"flex items-center gap-2 text-red-600",children:[e.jsx(G,{className:"w-5 h-5"}),"Delete Slot"]}),e.jsxs(Ve,{children:["Are you sure you want to permanently delete this slot? This action cannot be undone.",p&&e.jsxs("div",{className:"mt-2 p-2 bg-slate-50 rounded text-sm",children:[e.jsx("strong",{children:"Slot:"})," ",q(p.startTime)," - ",q(p.endTime)]})]})]}),e.jsxs(ze,{children:[e.jsx(Be,{disabled:!!f,children:"Cancel"}),e.jsx(qe,{onClick:()=>{p&&z(p.id)},disabled:!!f,className:"bg-red-600 hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed",children:f?e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"w-4 h-4 mr-2 animate-spin"}),"Deleting..."]}):"Delete Slot"})]})]})})]})}const le=({slot:r,onEdit:n,onToggle:s,onDelete:i,getSlotUtilization:d,getUtilizationColor:g,getUtilizationStatus:p,isDeleting:j,isToggling:h})=>{const v=d(r),u=g(v),b=p(v),f=b.icon;return e.jsxs("div",{className:`border rounded-lg p-4 mb-3 transition-all duration-200 hover:shadow-md ${r.type==="pickup"?"border-emerald-200 hover:border-emerald-300":"border-indigo-200 hover:border-indigo-300"} ${!r.active&&"bg-slate-50 opacity-75"} ${j&&"opacity-50 pointer-events-none"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ns,{className:"w-4 h-4 text-slate-500"}),e.jsxs("span",{className:"font-semibold text-slate-900",children:[q(r.startTime)," - ",q(r.endTime)]}),j&&e.jsx(te,{variant:"secondary",className:"text-xs bg-red-50 text-red-600 border-red-200",children:"Deleting..."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[h?e.jsx("div",{className:"w-5 h-5 border-2 border-slate-300 border-t-blue-500 rounded-full animate-spin"}):e.jsx(os,{checked:r.active,onCheckedChange:s,disabled:j}),e.jsx(te,{variant:r.active?"default":"secondary",className:`text-xs ${r.active?"bg-green-100 text-green-800 border-green-200":"bg-slate-100 text-slate-600 border-slate-200"}`,children:r.active?"Active":"Inactive"})]})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1 text-slate-600",children:[e.jsx(rs,{className:"w-3 h-3"}),e.jsx("span",{children:"Capacity"})]}),e.jsxs("span",{className:"font-medium text-slate-800",children:[r.currentOrders," / ",r.maxOrders]})]}),e.jsx("div",{className:"w-full bg-slate-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${u}`,style:{width:`${v}%`}})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:`flex items-center gap-1 text-xs ${b.color}`,children:[e.jsx(f,{className:"w-3 h-3"}),e.jsx("span",{className:"font-medium",children:b.label})]}),e.jsxs("span",{className:"text-xs font-bold text-slate-600",children:[v,"% filled"]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(w,{size:"sm",variant:"ghost",onClick:n,className:"h-8 px-2 hover:bg-blue-50 hover:text-blue-700",disabled:j||h,children:e.jsx(bs,{className:"w-3 h-3"})}),e.jsx(w,{size:"sm",variant:"ghost",onClick:i,className:"h-8 px-2 hover:bg-red-50 hover:text-red-700",disabled:j||h,children:j?e.jsx(Ne,{className:"w-3 h-3 animate-spin"}):e.jsx(fs,{className:"w-3 h-3"})})]})]})};function Us({open:r,onClose:n}){const[s,i]=c.useState("pickup"),[d,g]=c.useState(0),[p,j]=c.useState(2),[h,v]=c.useState([{startTime:"",endTime:"",maxOrders:5}]),[u,b]=c.useState({timeRanges:[{}]}),f=oe(),S=V(ce);c.useEffect(()=>{r||(i("pickup"),g(0),j(2),v([{startTime:"",endTime:"",maxOrders:5}]),b({timeRanges:[{}]}))},[r]);const k=(a,l)=>{if(!a||!l)return 0;const o=new Date(`2000-01-01T${a}`),m=new Date(`2000-01-01T${l}`);return m<=o&&m.setDate(m.getDate()+1),(m.getTime()-o.getTime())/(1e3*60*60)},E=a=>{if(a===0)return"";const l=Math.floor(a),o=Math.round((a-l)*60);return o===0?`${l} hour${l!==1?"s":""}`:`${l}h ${o}m`},z=()=>{const a={timeRanges:h.map(()=>({}))};let l=!1;h.forEach((o,m)=>{if(o.startTime.trim()||(a.timeRanges[m].startTime="Start time is required",l=!0),o.endTime.trim()||(a.timeRanges[m].endTime="End time is required",l=!0),o.startTime&&o.endTime){const t=new Date(`2000-01-01T${o.startTime}`),x=new Date(`2000-01-01T${o.endTime}`);x<=t&&x.setDate(x.getDate()+1);const N=k(o.startTime,o.endTime);N>2&&(a.timeRanges[m].duration=`Duration cannot exceed 2 hours (current: ${E(N)})`,l=!0),N<.5&&(a.timeRanges[m].duration="Duration must be at least 30 minutes",l=!0)}(!o.maxOrders||o.maxOrders<1)&&(a.timeRanges[m].maxOrders="Max orders must be at least 1",l=!0),o.maxOrders>100&&(a.timeRanges[m].maxOrders="Max orders cannot exceed 100",l=!0)});for(let o=0;o<h.length;o++)for(let m=o+1;m<h.length;m++){const t=h[o],x=h[m];if(t.startTime&&t.endTime&&x.startTime&&x.endTime){const N=new Date(`2000-01-01T${t.startTime}`),y=new Date(`2000-01-01T${t.endTime}`),C=new Date(`2000-01-01T${x.startTime}`),$=new Date(`2000-01-01T${x.endTime}`);y<=N&&y.setDate(y.getDate()+1),$<=C&&$.setDate($.getDate()+1),N<$&&C<y&&(a.timeRanges[o].timeRange="Time ranges cannot overlap",a.timeRanges[m].timeRange="Time ranges cannot overlap",l=!0)}}return b(a),!l},_=async()=>{if(!z()){R.error("Please fix the validation errors");return}const a=await f(se({type:s,weekDay:d,propagateWeeks:p,timeRanges:h}));se.fulfilled.match(a)?(i("pickup"),g(1),j(2),v([{startTime:"",endTime:"",maxOrders:5}]),b({timeRanges:[{}]}),R.success("Slots created successfully"),n()):R.error(a.payload||"Failed to create slots")},T=(a,l,o)=>{const m=[...h];m[a]={...m[a],[l]:o},v(m);const t={...u};l==="startTime"?delete t.timeRanges[a].startTime:l==="endTime"?delete t.timeRanges[a].endTime:l==="maxOrders"&&delete t.timeRanges[a].maxOrders,(l==="startTime"||l==="endTime")&&(delete t.timeRanges[a].timeRange,delete t.timeRanges[a].duration),b(t)},I=()=>{v([...h,{startTime:"",endTime:"",maxOrders:5}]),b({...u,timeRanges:[...u.timeRanges,{}]})},F=a=>{if(h.length>1){const l=h.filter((m,t)=>t!==a),o={...u,timeRanges:u.timeRanges.filter((m,t)=>t!==a)};v(l),b(o)}},L=[{label:"Sunday",value:0},{label:"Monday",value:1},{label:"Tuesday",value:2},{label:"Wednesday",value:3},{label:"Thursday",value:4},{label:"Friday",value:5},{label:"Saturday",value:6}];return e.jsx(ge,{open:r,onOpenChange:n,children:e.jsxs(fe,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsx(je,{children:e.jsx(ve,{children:"Add Slots (Propagated by Week)"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(A,{children:"Type"}),e.jsxs(J,{value:s,onValueChange:a=>i(a),children:[e.jsx(Y,{children:e.jsx(K,{placeholder:"Select Type"})}),e.jsxs(Q,{children:[e.jsx(H,{value:"pickup",children:"Pickup"}),e.jsx(H,{value:"delivery",children:"Delivery"})]})]})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Weekday"}),e.jsxs(J,{value:d.toString(),onValueChange:a=>g(Number(a)),children:[e.jsx(Y,{children:e.jsx(K,{placeholder:"Select Weekday"})}),e.jsx(Q,{children:L.map(a=>e.jsx(H,{value:a.value.toString(),children:a.label},a.value))})]})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Propagate Weeks"}),e.jsx(P,{type:"number",min:1,max:12,value:p,onChange:a=>{const l=Math.max(1,Math.min(12,Number(a.target.value)));j(l)}})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Time Ranges"}),e.jsx("p",{className:"text-sm text-slate-600 mb-3",children:"Each slot duration must not exceed 2 hours."}),h.map((a,l)=>{var x,N,y,C,$,X,Z,ee;const o=k(a.startTime,a.endTime),m=o>0?E(o):"",t=o>0&&o<=2;return e.jsxs("div",{className:"border p-4 rounded-lg mb-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(A,{className:"text-sm",children:"Start Time"}),e.jsx(P,{type:"time",value:a.startTime,onChange:W=>T(l,"startTime",W.target.value),className:(x=u.timeRanges[l])!=null&&x.startTime?"border-red-500":""}),((N=u.timeRanges[l])==null?void 0:N.startTime)&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:u.timeRanges[l].startTime})]}),e.jsxs("div",{children:[e.jsx(A,{className:"text-sm",children:"End Time"}),e.jsx(P,{type:"time",value:a.endTime,onChange:W=>T(l,"endTime",W.target.value),className:(y=u.timeRanges[l])!=null&&y.endTime?"border-red-500":""}),((C=u.timeRanges[l])==null?void 0:C.endTime)&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:u.timeRanges[l].endTime})]})]}),m&&e.jsx("div",{className:"mt-2",children:e.jsxs("div",{className:`text-xs px-2 py-1 rounded inline-block ${t?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"}`,children:["Duration: ",m,o>2&&" (exceeds 2-hour limit)"]})}),(($=u.timeRanges[l])==null?void 0:$.duration)&&e.jsx("p",{className:"text-red-500 text-xs mt-2",children:u.timeRanges[l].duration}),((X=u.timeRanges[l])==null?void 0:X.timeRange)&&e.jsx("p",{className:"text-red-500 text-xs mt-2",children:u.timeRanges[l].timeRange}),e.jsxs("div",{className:"flex gap-2 mt-4 items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(A,{className:"text-sm",children:"Max Orders"}),e.jsx(P,{type:"number",min:"1",max:"100",value:a.maxOrders,onChange:W=>T(l,"maxOrders",Number(W.target.value)),className:(Z=u.timeRanges[l])!=null&&Z.maxOrders?"border-red-500":""}),((ee=u.timeRanges[l])==null?void 0:ee.maxOrders)&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:u.timeRanges[l].maxOrders})]}),h.length>1&&e.jsx(w,{type:"button",variant:"destructive",size:"sm",onClick:()=>F(l),children:"Remove"})]})]},l)}),e.jsx(w,{type:"button",variant:"outline",onClick:I,children:"+ Add Time Range"})]}),u.general&&e.jsx("p",{className:"text-red-500 text-sm",children:u.general}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{onClick:_,disabled:S,className:"flex-1",children:S?"Creating...":"Create Slots"}),e.jsx(w,{variant:"outline",disabled:S,onClick:n,children:"Cancel"})]})]})]})})}function gt(){const[r,n]=c.useState("all"),[s,i]=c.useState({}),[d,g]=c.useState(!1),p=()=>g(!0);return e.jsx(ls,{children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex flex-row justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Slot Configuration"}),e.jsx("br",{}),e.jsx("p",{className:"text-muted-foreground",children:"Configure your slots."})]}),e.jsx("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs(J,{value:r,onValueChange:j=>n(j),children:[e.jsx(Y,{className:"w-[150px]",children:e.jsx(K,{placeholder:"Select Type"})}),e.jsxs(Q,{children:[e.jsx(H,{value:"all",children:"All"}),e.jsx(H,{value:"pickup",children:"Pickup"}),e.jsx(H,{value:"delivery",children:"Delivery"})]})]}),e.jsx(ns,{value:s,onChange:i}),((s==null?void 0:s.startDate)||(s==null?void 0:s.endDate))&&e.jsxs(w,{variant:"outline",onClick:()=>i({}),className:"flex items-center gap-1",children:[e.jsx(Ts,{className:"w-4 h-4"}),"Clear"]}),e.jsxs(w,{className:"fixed bottom-6 right-6 rounded-full shadow-lg px-5 py-5 z-50",onClick:p,children:[e.jsx(ys,{className:"w-4 h-4 mr-2"}),"Add Slot"]})]})})]}),e.jsx("br",{}),e.jsx(Hs,{type:r,dateRange:s}),e.jsx(Us,{open:d,onClose:()=>g(!1)})]})})}export{gt as default};
