import{u,q as h,r as f,b as p,A as m,j as a}from"./index-ByY07t5U.js";import{D as y}from"./DashboardLayout-CorAQK4x.js";import{B as w}from"./BannerForm-X6-0a5N7.js";import"./button-DBciqQcI.js";import"./input-DcxO3ESS.js";import"./textarea-CMzAX9ph.js";import"./form-D1pnXXWo.js";import"./index-pvnq_pFp.js";import"./label-CtRxIZG0.js";import"./upload-Dz_LuVq4.js";const x=s=>new Promise((t,l)=>{if(!["image/png","image/jpeg","image/jpg"].includes(s.type)){l(new Error("Only PNG and JPG images are supported"));return}const r=new FileReader;r.readAsDataURL(s),r.onload=()=>{const c=r.result;t(c)},r.onerror=c=>l(c)}),b=()=>{const s=u(),{toast:t}=h(),[l,r]=f.useState(!1);return{handleCreateBanner:async e=>{try{if(r(!0),e.imageUrl.startsWith("data:image")){const i=e.imageUrl.split(";")[0].split(":")[1];if(!["image/png","image/jpeg","image/jpg"].includes(i))throw new Error("Only PNG and JPG images are supported")}let o=e.imageUrl;if(e.imageUrl&&!e.imageUrl.startsWith("data:image"))try{const n=await(await fetch(e.imageUrl)).blob();if(!["image/png","image/jpeg","image/jpg"].includes(n.type))throw new Error("Only PNG and JPG images are supported");o=await x(new File([n],"banner-image",{type:n.type}))}catch(i){throw console.error("Error converting URL to base64:",i),new Error("Failed to process image URL")}const g={title:e.title,description:e.description,fileBase64Image:o},d=await p.post(`${m.CREATE_BANNER()}`,g,{headers:{"Content-Type":"application/json"}});if(d.data.success){const i=d.data.bannerId;if(e.isActive===!1)try{await p.patch(`${m.TOGGLE_BANNER_STATUS()}`,null,{params:{bannerId:i}})}catch(n){console.error("Failed to update banner status:",n),t({title:n.response.data.message,description:"The banner was created but we couldn't update its status. You may need to update it manually.",variant:"destructive"})}t({title:"Banner created",description:"The banner has been created successfully."}),s("/config/app-banner")}else throw new Error(d.data.message||"Failed to create banner")}catch(o){t({title:"Error",description:o instanceof Error?o.message:"Failed to create banner",variant:"destructive"})}finally{r(!1)}},isSubmitting:l}};function G(){const{handleCreateBanner:s,isSubmitting:t}=b();return a.jsx(y,{children:a.jsxs("div",{className:"flex flex-col gap-6",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:"Create Banner"}),a.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Add a new promotional banner to display in your app"})]}),a.jsx("div",{className:"rounded-md border p-6",children:a.jsx(w,{onSave:s,isSubmitting:t})})]})})}export{G as default};
