import{r as d,u as D,j as e,b as C,J as S}from"./index-ByY07t5U.js";import{B as F}from"./button-DBciqQcI.js";import{I as v}from"./input-DcxO3ESS.js";import{S as _,a as L,b as R,c as G,d as M}from"./select-DSUhFaX8.js";import{C as w,a as E,b as P,e as I,c as A,d as V}from"./card-DrHBsbjm.js";import{F as z,a as m,b as x,c as p,d as g,e as j}from"./form-D1pnXXWo.js";import{u as J,z as l,t as k}from"./index-pvnq_pFp.js";import"./index-DjrpyVfh.js";import"./Combination-DHf6tu9R.js";import"./index-Dxwkp90n.js";import"./index-DDlNMbpf.js";import"./label-CtRxIZG0.js";const q=5*1024*1024,B=["image/jpeg","image/jpg","image/png","image/webp"],H=l.object({name:l.string().min(1,"Name is required"),description:l.string().min(10,"Description must be at least 10 characters"),pricingModel:l.string().min(1,"Pricing model is required"),image:l.any().refine(r=>r instanceof File,"Please upload an image").refine(r=>(r==null?void 0:r.size)<=q,"Max image size is 5MB").refine(r=>B.includes(r==null?void 0:r.type),"Only .jpg, .jpeg, .png and .webp formats are supported")}),K=r=>new Promise((h,o)=>{const i=new FileReader;i.readAsDataURL(r),i.onload=()=>h(i.result),i.onerror=u=>o(u)});function te(){const r=d.useRef(null),h=D(),[o,i]=d.useState([]),[u,b]=d.useState(!1),t=J({resolver:k(H),defaultValues:{name:"",description:"",pricingModel:"",image:void 0}}),y=async()=>{var s,n;try{b(!0);const a=await C.get("/getAllServices");console.log("result ",a),i(a.data.data||[])}catch(a){console.error("Fetch error:",a),S("Failed to fetch services",{description:((n=(s=a.response)==null?void 0:s.data)==null?void 0:n.message)||"Try again later"})}finally{b(!1)}};d.useEffect(()=>{y()},[]);const T=async s=>{var n,a;try{const c=await K(s.image),f={name:s.name,description:s.description,pricingModel:s.pricingModel,imageBase64:c};await C.post("/createService",f,{headers:{"Content-Type":"application/json"}}),S("Service Added",{description:"Service has been added successfully!"}),t.reset(),r.current&&(r.current.value=""),y()}catch(c){console.error("Submission error:",c),S("Submission Failed",{description:((a=(n=c.response)==null?void 0:n.data)==null?void 0:a.message)||"Something went wrong"})}};return e.jsx("div",{className:"min-h-screen bg-gray-50 py-10 px-4",children:e.jsxs("div",{className:"max-w-xl mx-auto",children:[e.jsxs(w,{children:[e.jsxs(E,{className:"space-y-1",children:[e.jsx(P,{className:"text-2xl font-bold text-center",children:"Add Service"}),e.jsx(I,{className:"text-center",children:"Add services one by one, then complete."})]}),e.jsx(A,{children:e.jsx(z,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(T),className:"space-y-4",children:[e.jsx(m,{control:t.control,name:"name",render:({field:s})=>e.jsxs(x,{children:[e.jsx(p,{children:"Name of Service"}),e.jsx(g,{children:e.jsx(v,{placeholder:"Enter service name",...s})}),e.jsx(j,{})]})}),e.jsx(m,{control:t.control,name:"description",render:({field:s})=>e.jsxs(x,{children:[e.jsx(p,{children:"Description"}),e.jsx(g,{children:e.jsx(v,{placeholder:"Enter description",...s})}),e.jsx(j,{})]})}),e.jsx(m,{control:t.control,name:"pricingModel",render:({field:s})=>e.jsxs(x,{children:[e.jsx(p,{children:"Pricing Model"}),e.jsxs(_,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(g,{children:e.jsx(L,{children:e.jsx(R,{placeholder:"Select pricing model"})})}),e.jsxs(G,{children:[e.jsx(M,{value:"per_item",children:"Per Item"}),e.jsx(M,{value:"per_kg",children:"Per Kg"})]})]}),e.jsx(j,{})]})}),e.jsx(m,{control:t.control,name:"image",render:({field:{onChange:s,value:n,...a}})=>e.jsxs(x,{children:[e.jsx(p,{children:"Image"}),e.jsx(g,{children:e.jsx(v,{type:"file",accept:B.join(","),onChange:c=>{var N;const f=(N=c.target.files)==null?void 0:N[0];s(f)},ref:r})}),e.jsx(j,{})]})}),e.jsx(F,{type:"submit",className:"w-full",children:t.formState.isSubmitting?"Adding...":"Add Service"}),e.jsx(F,{disabled:!o.length>0,onClick:()=>h("/"),className:"w-full mb-4",children:"Complete and Go to Home"})]})})}),e.jsx(V,{className:"flex justify-center",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Supported formats: JPEG, PNG, WEBP (Max 5MB)"})})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Available Services"}),u?e.jsx("p",{className:"text-center text-sm text-gray-500",children:"Loading services..."}):o.length===0?e.jsx("p",{className:"text-center text-sm text-gray-500",children:"No services found."}):o.map((s,n)=>e.jsxs(w,{children:[e.jsxs(E,{children:[e.jsx(P,{children:s.name}),e.jsx(I,{children:s.description})]}),e.jsxs(A,{children:[e.jsxs("p",{className:"text-sm",children:["Pricing: ",s.pricingModel]}),e.jsx("img",{src:s.imageBase64,alt:s.name,className:"mt-2 rounded-md w-full h-40 object-cover"})]})]},n))]})]})})}export{te as default};
