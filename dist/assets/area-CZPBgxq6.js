import{s as T,v as O,w as ce,r as n,j as e,x as pe,y as fe,z as je,B as be,C as ve,D as Ne,E as Se,F as ye,G as we,H as te,J as ae,I as le,X as Ce}from"./index-ByY07t5U.js";import{M as Ae,D as ke}from"./DashboardLayout-CorAQK4x.js";import{c as Pe,d as De}from"./card-DrHBsbjm.js";import{T as Me,a as Le,b as H,c as _}from"./tabs-jpblMaOk.js";import{I as Ie}from"./input-DcxO3ESS.js";import{B as f}from"./button-DBciqQcI.js";import{S as J,a as U,b as X,c as $,d as A}from"./select-DSUhFaX8.js";import{T as ze,a as Fe,b as Y,c as Z,d as Oe,e as V}from"./table-DrbJVUPK.js";import{B as ne}from"./badge-B45milNp.js";import{S as Ke}from"./switch-C1bv9KX7.js";import{T as re,D as Ve,a as Be,d as Re}from"./dialog-DND4cV_M.js";import{S as Ge}from"./square-pen-BFr-I4KV.js";import{A as oe,a as de,b as xe}from"./arrow-up-CY5QDakW.js";import{u as qe,S as He,G as _e,M as Je}from"./esm-pF9UzyqD.js";import{u as Ue}from"./index-DtW1NRNC.js";import{S as ie}from"./search-d2cfHkwq.js";import{F as Xe}from"./filter-BcVLYW8s.js";import"./index-n1Mj4gwV.js";import"./index-Dxwkp90n.js";import"./index-DjrpyVfh.js";import"./Combination-DHf6tu9R.js";import"./index-DDlNMbpf.js";const Q=({field:o,currentSortField:s,sortOrder:u,onSort:m,children:D,className:j=""})=>{const b=()=>s!==o?e.jsx(oe,{className:"w-4 h-4 text-gray-400"}):u==="asc"?e.jsx(de,{className:"w-4 h-4 text-purple-600"}):e.jsx(xe,{className:"w-4 h-4 text-purple-600"});return e.jsx(Z,{className:`font-semibold text-gray-700 cursor-pointer hover:bg-purple-100 transition-colors ${j}`,onClick:()=>m==null?void 0:m(o),children:e.jsxs("div",{className:"flex items-center justify-between group",children:[D,b()]})})};function W({areas:o,onEditClick:s,sortField:u,sortOrder:m,onSort:D}){const j=T(),b=O(ce),[F,y]=n.useState(null),[I,v]=n.useState(!1),[d,a]=n.useState(null),x=async r=>{y(r),await j(pe(r)),y(null)},w=async()=>{d&&(y(d),await j(fe(d)),y(null),v(!1),a(null))};return e.jsxs("div",{className:"border rounded-lg shadow-sm mt-4 overflow-hidden",children:[e.jsxs(ze,{children:[e.jsx(Fe,{children:e.jsxs(Y,{className:"bg-purple-50",children:[e.jsx(Q,{field:"name",currentSortField:u,sortOrder:m,onSort:D,children:"Name"}),e.jsx(Z,{className:"font-semibold text-gray-700",children:"Address"}),e.jsx(Q,{field:"range",currentSortField:u,sortOrder:m,onSort:D,children:"Service Range (km)"}),e.jsx(Q,{field:"status",currentSortField:u,sortOrder:m,onSort:D,children:"Status"}),e.jsx(Z,{className:"text-right font-semibold text-gray-700",children:"Actions"})]})}),e.jsx(Oe,{children:o.length===0?e.jsx(Y,{children:e.jsx(V,{colSpan:5,className:"text-center py-6 text-gray-500",children:"No areas found"})}):o.map((r,k)=>e.jsxs(Y,{className:`transition-colors ${k%2===0?"bg-white":"bg-gray-50"} hover:bg-purple-50`,children:[e.jsx(V,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ae,{size:16,className:"text-purple-600 flex-shrink-0"}),e.jsx("span",{className:"truncate max-w-[200px]",title:r.locationName,children:r.locationName})]})}),e.jsx(V,{className:"text-gray-600 max-w-[250px]",children:e.jsx("span",{className:"truncate block",title:r.address||"N/A",children:r.address||"N/A"})}),e.jsx(V,{className:"text-gray-600",children:e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[r.range," km"]})}),e.jsx(V,{children:r.isActive?e.jsx(ne,{className:"bg-green-100 text-green-800 border border-green-300",children:"Active"}):e.jsx(ne,{className:"bg-red-100 text-red-800 border border-red-300",children:"Inactive"})}),e.jsx(V,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2 items-center",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-xs text-gray-500 hidden sm:inline",children:r.isActive?"On":"Off"}),e.jsx(Ke,{checked:r.isActive,onCheckedChange:()=>x(r.id),disabled:b||F===r.id})]}),e.jsx(f,{onClick:()=>s==null?void 0:s(r),variant:"outline",size:"icon",disabled:b,title:"Edit area",className:"border-purple-300 text-purple-600 hover:bg-purple-100 h-8 w-8",children:e.jsx(Ge,{size:14})}),e.jsx(f,{onClick:()=>{a(r.id),v(!0)},variant:"outline",size:"icon",disabled:b,title:"Delete area",className:"border-red-300 text-red-600 hover:bg-red-100 h-8 w-8",children:F===r.id?e.jsx("span",{className:"animate-spin h-3 w-3 rounded-full border-2 border-t-transparent border-red-500"}):e.jsx(re,{size:14})})]})})]},r.id))})]}),e.jsx(Ve,{open:I,onOpenChange:v,children:e.jsxs(Be,{className:"sm:max-w-md",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-red-100 flex items-center justify-center",children:e.jsx(re,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Delete Service Area"}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"This action cannot be undone. Are you sure you want to delete this service area?"})]})]}),e.jsxs(Re,{className:"flex justify-end gap-2",children:[e.jsx(f,{variant:"outline",onClick:()=>{v(!1),a(null)},disabled:b,children:"Cancel"}),e.jsx(f,{variant:"destructive",onClick:w,disabled:b,className:"min-w-[80px]",children:F===d?e.jsx("span",{className:"animate-spin h-4 w-4 rounded-full border-2 border-t-transparent border-white"}):"Delete"})]})]})})]})}const $e=({isOpen:o,onClose:s,children:u})=>o?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-white w-full max-w-5xl mx-auto rounded-lg shadow-lg relative",children:[e.jsx("button",{onClick:s,className:"absolute top-2 right-2 text-gray-600 hover:text-black text-xl font-bold",children:"×"}),e.jsx("div",{className:"p-4 max-h-[90vh] overflow-y-auto",children:u})]})}):null,Ye="AIzaSyCezEfXJkSCvz2n2qctuwR2T0bnDtLOg_k",Qe=["places"],We={width:"100%",height:"400px"},p={lat:-34.397,lng:150.644},Ze=({close:o,areaToEdit:s})=>{const u=T(),m=O(ce),{isLoaded:D,loadError:j}=qe({googleMapsApiKey:Ye,libraries:Qe}),[b,F]=n.useState(null),[y,I]=n.useState(null),[v,d]=n.useState(p),[a,x]=n.useState({storeName:"",serviceAreaKm:void 0,address:"",lat:p.lat,lng:p.lng}),[w,r]=n.useState(null);n.useEffect(()=>{s&&(x({storeName:s.locationName,serviceAreaKm:s.range,address:s.address??"",lat:(s==null?void 0:s.lat)??p.lat,lng:(s==null?void 0:s.lng)??p.lng}),s.lat&&s.lng&&d({lat:s.lat,lng:s.lng}))},[s]);const k=n.useCallback(l=>{if(!l.latLng)return;const i=l.latLng.lat(),c=l.latLng.lng();d({lat:i,lng:c}),x(P=>({...P,lat:i,lng:c})),M(i,c)},[]),M=(l,i)=>{if(!window.google)return;new window.google.maps.Geocoder().geocode({location:{lat:l,lng:i}},(g,P)=>{P==="OK"&&g&&g[0]?x(z=>({...z,address:g[0].formatted_address})):console.error("Geocoder failed due to:",P)})};n.useEffect(()=>{s&&(x({storeName:s.locationName,serviceAreaKm:s.range,address:s.address??"",lat:(s==null?void 0:s.lat)??p.lat,lng:(s==null?void 0:s.lng)??p.lng}),s.lat&&s.lng&&d({lat:s.lat,lng:s.lng}))},[s]);const N=n.useCallback(l=>{if(F(l),s!=null&&s.lat&&(s!=null&&s.lng)){const i={lat:s.lat,lng:s.lng};l.panTo(i),d(i),M(i.lat,i.lng)}else navigator.geolocation?navigator.geolocation.getCurrentPosition(i=>{const c={lat:i.coords.latitude,lng:i.coords.longitude};l.panTo(c),d(c),x(g=>({...g,lat:c.lat,lng:c.lng})),M(c.lat,c.lng)},()=>{d(p),M(p.lat,p.lng)}):(d(p),M(p.lat,p.lng))},[s]),B=l=>{I(l)},C=()=>{if(y){const l=y.getPlaces();if(l&&l.length>0){const i=l[0],c={lat:i.geometry.location.lat(),lng:i.geometry.location.lng()};b&&(b.panTo(c),d(c),x(g=>({...g,lat:c.lat,lng:c.lng})),x(g=>({...g,address:i.formatted_address})))}}},K=async l=>{if(l.preventDefault(),!a.storeName.trim()){r("Store name is required");return}if(!a.serviceAreaKm||a.serviceAreaKm<=0){r("Service area must be a positive number");return}if(!a.lat||!a.lng){r("Please select a location on the map");return}r(null);const i={locationName:a.storeName,coordinates:{latitude:a.lat,longitude:a.lng},range:a.serviceAreaKm,address:a.address};u(s?je({id:s.id,updatedData:i}):be(i))};return j?e.jsx("div",{children:"Error loading maps"}):e.jsxs("div",{className:"p-4 max-w-3xl mx-auto space-y-4",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:s?"Edit Store Location":"Add New Store Location"}),e.jsxs("form",{onSubmit:K,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Store Name: *"}),e.jsx("input",{type:"text",value:a.storeName,onChange:l=>x({...a,storeName:l.target.value}),className:"border rounded px-3 py-2 w-full focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter your store name",required:!0}),e.jsx("label",{className:"block text-sm font-medium",children:"Detected Address:"}),e.jsx("div",{className:"border rounded px-3 py-2 bg-gray-100 text-sm min-h-[40px]",children:a.address||"No address detected yet"}),e.jsx("label",{className:"block text-sm font-medium",children:"Service Area (in KM): *"}),e.jsx("input",{type:"number",min:"0.1",step:"0.1",value:a.serviceAreaKm||"",onChange:l=>x({...a,serviceAreaKm:Number(l.target.value)}),className:"border rounded px-3 py-2 w-full focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Service Area in Kilometers",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Location (Click on map or search to select):"}),e.jsx("div",{style:{position:"relative",height:"400px"},children:D?e.jsxs(e.Fragment,{children:[e.jsx(He,{onLoad:B,onPlacesChanged:C,children:e.jsx("input",{type:"text",placeholder:"Search for a location...",style:{boxSizing:"border-box",border:"1px solid transparent",width:"240px",height:"32px",padding:"0 12px",borderRadius:"3px",boxShadow:"0 2px 6px rgba(0, 0, 0, 0.3)",fontSize:"14px",outline:"none",textOverflow:"ellipses",position:"absolute",top:"10px",left:"50%",transform:"translateX(-50%)",zIndex:"10"}})}),e.jsx(_e,{mapContainerStyle:We,center:v,zoom:15,onLoad:N,onClick:k,children:e.jsx(Je,{position:v})})]}):e.jsx("div",{className:"flex items-center justify-center h-[400px] border rounded bg-gray-100",children:e.jsx("span",{children:"Loading map..."})})})]}),w&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:w}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsxs("button",{type:"submit",disabled:m,className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[m&&e.jsx("span",{className:"animate-spin rounded-full h-4 w-4 border-2 border-t-transparent border-white"}),m?s?"Updating...":"Creating...":s?"Update Store":"Create Store"]}),e.jsx("button",{type:"button",onClick:o,disabled:m,className:"bg-gray-500 text-white px-6 py-2 rounded hover:bg-gray-600 disabled:opacity-50",children:"Cancel"})]})]})]})};function Te(){const o=T(),s=Ue(ve);O(Ne);const u=O(Se),m=O(ye),D=O(t=>t.location.total),j=O(we),[b,F]=n.useState("all"),[y,I]=n.useState(!1),[v,d]=n.useState(null),[a,x]=n.useState(1),[w,r]=n.useState(10),[k,M]=n.useState(""),[N,B]=n.useState("name"),[C,K]=n.useState("asc"),[l,i]=n.useState("all"),[c,g]=n.useState(!1);n.useEffect(()=>{o(te({page:a,limit:w}))},[o,a,w]),n.useEffect(()=>{m&&(ae.success("Operation completed successfully!"),o(le()),y&&(I(!1),d(null)),o(te({page:a,limit:w})))},[m,o,y,a,w]),n.useEffect(()=>{u&&(ae.error(u),o(le()))},[u,o]);const P=n.useMemo(()=>{let t=[...s];if(k.trim()){const h=k.toLowerCase();t=t.filter(S=>S.locationName.toLowerCase().includes(h)||S.address&&S.address.toLowerCase().includes(h))}return l!=="all"&&(t=t.filter(h=>l==="active"?h.isActive:!h.isActive)),t.sort((h,S)=>{let L=0;switch(N){case"name":L=h.locationName.localeCompare(S.locationName);break;case"range":L=h.range-S.range;break;case"status":L=h.isActive===S.isActive?0:h.isActive?-1:1;break}return C==="asc"?L:-L}),t},[s,k,l,N,C]),z={all:P,active:P.filter(t=>t.isActive),inactive:P.filter(t=>!t.isActive)},me=()=>{const h=Math.floor(2.5);let S=Math.max(1,a-h);const L=Math.min(j,S+5-1);L-S+1<5&&(S=Math.max(1,L-5+1));const se=[];for(let q=S;q<=L;q++)se.push(q);return se},R=t=>{d(t),I(!0)},E=()=>{I(!1),d(null)},G=t=>{N===t?K(C==="asc"?"desc":"asc"):(B(t),K("asc"))},ue=()=>{M(""),B("name"),K("asc"),i("all")},he=t=>{const h=parseInt(t,10);r(h),x(1)},ee=k||N!=="name"||C!=="asc"||l!=="all",ge=t=>N!==t?e.jsx(oe,{className:"w-4 h-4"}):C==="asc"?e.jsx(de,{className:"w-4 h-4"}):e.jsx(xe,{className:"w-4 h-4"});return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Service Areas"}),e.jsxs("div",{className:"flex flex-row justify-between align-center",children:[e.jsxs("p",{className:"text-muted-foreground",children:["Configure service areas for your application. Total areas: ",D,"."]}),e.jsx(f,{size:"sm",onClick:()=>I(!0),className:"bg-purple-600 text-white hover:bg-purple-700",children:"Add Service Area"})]}),e.jsx($e,{isOpen:y,onClose:E,children:e.jsx(Ze,{close:E,areaToEdit:v},(v==null?void 0:v.id)||"new")}),e.jsxs(Pe,{children:[e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(Ie,{placeholder:"Search by name or address...",value:k,onChange:t=>M(t.target.value),className:"pl-10 pr-10"}),k&&e.jsx(f,{variant:"ghost",size:"sm",className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-1 h-auto",onClick:()=>M(""),children:e.jsx(Ce,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs(f,{variant:"outline",onClick:()=>g(!c),className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"w-4 h-4"}),"Filters"," ",ee&&e.jsx("span",{className:"text-purple-600",children:"•"})]}),ee&&e.jsx(f,{variant:"ghost",onClick:ue,className:"text-sm text-gray-600 hover:text-gray-800",children:"Clear all filters"}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",P.length," of ",s.length," areas"]})]}),c&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sort by"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(J,{value:N,onValueChange:t=>B(t),children:[e.jsx(U,{className:"flex-1",children:e.jsx(X,{})}),e.jsxs($,{children:[e.jsx(A,{value:"name",children:"Name"}),e.jsx(A,{value:"range",children:"Range"}),e.jsx(A,{value:"status",children:"Status"})]})]}),e.jsx(f,{variant:"outline",size:"icon",onClick:()=>K(C==="asc"?"desc":"asc"),children:ge(N)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs(J,{value:l,onValueChange:t=>i(t),children:[e.jsx(U,{children:e.jsx(X,{})}),e.jsxs($,{children:[e.jsx(A,{value:"all",children:"All Status"}),e.jsx(A,{value:"active",children:"Active Only"}),e.jsx(A,{value:"inactive",children:"Inactive Only"})]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(f,{variant:"outline",onClick:()=>g(!1),className:"w-full",children:"Hide Filters"})})]})]}),e.jsxs(Me,{value:b,onValueChange:F,children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(Le,{children:[e.jsxs(H,{value:"all",children:["All Areas (",z.all.length,")"]}),e.jsxs(H,{value:"active",children:["Active (",z.active.length,")"]}),e.jsxs(H,{value:"inactive",children:["Inactive (",z.inactive.length,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Rows per page:"}),e.jsxs(J,{value:w.toString(),onValueChange:he,children:[e.jsx(U,{className:"w-20",children:e.jsx(X,{placeholder:w})}),e.jsxs($,{children:[e.jsx(A,{value:"10",children:"10"}),e.jsx(A,{value:"15",children:"15"}),e.jsx(A,{value:"20",children:"20"}),e.jsx(A,{value:"25",children:"25"}),e.jsx(A,{value:"50",children:"50"})]})]})]})]}),e.jsx(_,{value:"all",children:e.jsx(W,{areas:z.all,onEditClick:R,sortField:N,sortOrder:C,onSort:G})}),e.jsx(_,{value:"active",children:e.jsx(W,{areas:z.active,onEditClick:R,sortField:N,sortOrder:C,onSort:G})}),e.jsx(_,{value:"inactive",children:e.jsx(W,{areas:z.inactive,onEditClick:R,sortField:N,sortOrder:C,onSort:G})})]}),P.length===0&&s.length>0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ie,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium",children:"No areas found"}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search or filter criteria"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4 mt-6 relative",children:[e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2",children:e.jsxs("span",{className:"text-sm text-gray-700",children:["Page ",a," of ",j||1]})}),e.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[e.jsx(f,{variant:"outline",size:"sm",onClick:()=>x(t=>Math.max(t-1,1)),disabled:a===1,children:"Previous"}),me().map(t=>e.jsx(f,{variant:a===t?"default":"outline",size:"icon",onClick:()=>x(t),className:"h-8 w-8",children:t},t)),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>x(t=>Math.min(t+1,j||t+1)),disabled:a===j||j===0,children:"Next"})]})]})]}),e.jsx(De,{})]})}function Ns(){return e.jsx(ke,{children:e.jsx(Te,{})})}export{Ns as default};
