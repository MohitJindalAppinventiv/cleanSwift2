import{r as l,j as e,b as j}from"./index-ByY07t5U.js";import{D as R}from"./DashboardLayout-CorAQK4x.js";import{S as b}from"./search-d2cfHkwq.js";import{C as f}from"./circle-alert-DAgzbPCO.js";import{C as D}from"./chevron-left-BFqG9IJl.js";import{C as F}from"./chevron-right-Nhb4I_UE.js";import{C as L}from"./clock-DBwSQnl3.js";import{E as M}from"./eye-VMx-kwYO.js";import"./button-DBciqQcI.js";function H(){const[p,u]=l.useState([]),[N,m]=l.useState(!0),[h,x]=l.useState(null),[a,v]=l.useState({page:1,limit:20,total:0,totalPages:0}),[i,w]=l.useState(""),[c,C]=l.useState("all"),S=async s=>{try{m(!0);const o=(await j.put("/adminMarkComplaintAsRead",null,{params:{id:s}})).data;if(o.success)u(r=>r.map(n=>n.id===s?{...n,status:"read",readAt:o.data.readAt}:n));else throw new Error("API returned unsuccessful response")}catch(t){console.error("Error marking complaint as read:",t),x(t.message||"Failed to mark complaint as read")}finally{m(!1)}},d=async(s=1,t="",o="all")=>{try{m(!0),x(null);const r={page:s.toString(),limit:a.limit.toString()};t.trim()&&(r.search=t.trim()),o!=="all"&&(r.status=o);const n=await j.get("/adminGetComplaints",{params:r});console.log("complaint response",n);const g=n.data;if(g.success)u(g.data.complaints),v(g.data.pagination);else throw new Error("API returned unsuccessful response")}catch(r){x(r.message||"Something went wrong"),console.error("Error fetching complaints:",r)}finally{m(!1)}};l.useEffect(()=>{d()},[]);const E=s=>{s.preventDefault(),d(1,i,c)},k=s=>{C(s),d(1,i,s)},y=s=>{s>=1&&s<=a.totalPages&&d(s,i,c)},A=s=>{const t="px-2 py-1 text-xs font-medium rounded-full flex items-center gap-1";switch(s){case"new":return`${t} bg-blue-100 text-blue-800`;case"read":return`${t} bg-yellow-100 text-yellow-800`;default:return`${t} bg-gray-100 text-gray-800`}},P=s=>{switch(s){case"new":return e.jsx(f,{size:12});case"read":return e.jsx(M,{size:12});default:return e.jsx(L,{size:12})}},z=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsx(R,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Complaint Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage and respond to user complaints"})]})}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:[e.jsx("div",{className:"flex-1 max-w-md",children:e.jsxs("div",{className:"relative",children:[e.jsx(b,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:16}),e.jsx("input",{type:"text",placeholder:"Search complaints...",value:i,onChange:s=>w(s.target.value),onKeyPress:s=>s.key==="Enter"&&E(s),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),e.jsx("div",{className:"flex gap-2",children:["all","new","read"].map(s=>e.jsx("button",{onClick:()=>k(s),className:`px-4 py-2 text-sm font-medium rounded-lg transition-colors ${c===s?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:s.charAt(0).toUpperCase()+s.slice(1)},s))})]})}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200",children:N?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading complaints..."})]}):h?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"text-red-500 mb-2",children:e.jsx(f,{size:48,className:"mx-auto"})}),e.jsx("h3",{className:"text-lg font-medium text-red-900 mb-2",children:"Error Loading Complaints"}),e.jsx("p",{className:"text-red-600 mb-4",children:h}),e.jsx("button",{onClick:()=>d(a.page,i,c),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Retry"})]}):p.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"text-gray-400 mb-2",children:e.jsx(b,{size:48,className:"mx-auto"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Complaints Found"}),e.jsx("p",{className:"text-gray-600",children:i||c!=="all"?"Try adjusting your search or filter criteria":"No complaints have been submitted yet"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 text-sm font-medium text-gray-700",children:[e.jsx("div",{className:"col-span-2",children:"User"}),e.jsx("div",{className:"col-span-4",children:"Message"}),e.jsx("div",{className:"col-span-2",children:"Status"}),e.jsx("div",{className:"col-span-2",children:"Created"}),e.jsx("div",{className:"col-span-2",children:"Actions"})]})}),e.jsx("div",{className:"divide-y divide-gray-200",children:p.map(s=>e.jsx("div",{className:"px-6 py-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-center",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.userName}),e.jsx("div",{className:"text-xs text-gray-500",children:s.userReadableId}),e.jsx("div",{className:"text-xs text-gray-400",children:s.userEmail})]}),e.jsx("div",{className:"col-span-4",children:e.jsx("p",{className:"text-sm text-gray-900 line-clamp-2",children:s.message})}),e.jsx("div",{className:"col-span-2",children:e.jsxs("span",{className:A(s.status),children:[P(s.status),s.status]})}),e.jsx("div",{className:"col-span-2",children:e.jsx("div",{className:"text-sm text-gray-600",children:z(s.createdAt)})}),e.jsx("div",{className:"col-span-2",children:s.status==="new"?e.jsx("button",{onClick:()=>S(s.id),className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:"Mark as Read"}):e.jsxs("span",{className:"text-xs text-gray-500 italic",children:["Already ",s.status]})})]})},s.id))}),a.totalPages>1&&e.jsx("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Showing page ",a.page," of ",a.totalPages,"(",a.total," total complaints)"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>y(a.page-1),disabled:a.page===1,className:"px-3 py-1 text-sm border border-gray-300 rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100 transition-colors flex items-center gap-1",children:[e.jsx(D,{size:16}),"Previous"]}),e.jsxs("span",{className:"px-3 py-1 text-sm",children:["Page ",a.page]}),e.jsxs("button",{onClick:()=>y(a.page+1),disabled:a.page===a.totalPages,className:"px-3 py-1 text-sm border border-gray-300 rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100 transition-colors flex items-center gap-1",children:["Next",e.jsx(F,{size:16})]})]})]})})]})})]})})}export{H as default};
