import{c as G,r as x,q as re,j as e,X as ie,b as k}from"./index-ByY07t5U.js";import{D as oe,a as _}from"./DashboardLayout-CorAQK4x.js";import{C as w,a as b,b as y,c as D,e as le}from"./card-DrHBsbjm.js";import{B as de}from"./badge-B45milNp.js";import{A as ce,b as xe}from"./avatar-ChsuDaDG.js";import{B as g}from"./button-DBciqQcI.js";import{I as me}from"./input-DcxO3ESS.js";import{S as c}from"./skeleton-D-G3Wgw9.js";import{T as Z,D as he,a as ue,b as pe,c as fe,e as je,d as ge}from"./dialog-DND4cV_M.js";import{P as Re,a as ve,b as R,c as Ne,d as V,e as we}from"./pagination-C8Rc9njr.js";import{M as be}from"./message-square-BXChRdbD.js";import{T as ye}from"./trending-up-DeYKARhs.js";import{S as De}from"./square-pen-BFr-I4KV.js";import"./index-Dxwkp90n.js";import"./Combination-DHf6tu9R.js";import"./chevron-left-BFqG9IJl.js";import"./chevron-right-Nhb4I_UE.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=G("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=G("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]]),Oe=()=>{const[r,T]=x.useState(null),[H,P]=x.useState([]),[i,U]=x.useState(null),[A,J]=x.useState(!0),[S,$]=x.useState(!0),[l,v]=x.useState(1),[C,K]=x.useState(20),[Q,M]=x.useState(null),[E,I]=x.useState(null),[N,L]=x.useState(""),[m,f]=x.useState({open:!1,type:"review",id:"",title:"",description:"",isLoading:!1}),[u,F]=x.useState({respond:{},updateResponse:{}}),{toast:h}=re(),W=async s=>{var t;$(!0);try{const a=await k.get("/getAllReviews",{params:{page:s,limit:C,includeDeleted:!1}});a.data.success&&(T(a.data.data.statistics),P(a.data.data.recentReviews),U(a.data.data.pagination),J(!1))}catch(a){const n=(t=a.response)==null?void 0:t.status;h({title:"Error",description:n===400?"Invalid request parameters":n===401?"Authentication failed":n===500?"Internal server error":"Failed to fetch reviews",variant:"destructive"})}finally{$(!1)}};x.useEffect(()=>{W(l)},[l,C]);const z=(s,t,a)=>{f({open:!0,type:s,id:t,reviewId:a,title:s==="review"?"Delete Review":"Delete Response",description:s==="review"?"Are you sure you want to delete this review? This action cannot be undone.":"Are you sure you want to delete this response? This action cannot be undone.",isLoading:!1})},Y=async()=>{var s;f(t=>({...t,isLoading:!0}));try{await k.delete("/adminDeleteReview",{params:{reviewId:m.id}}),P(t=>t.filter(a=>a.id!==m.id)),T(t=>{if(!t)return t;const a=H.find(q=>q.id===m.id);if(!a)return t;const n=t.totalReviews-1,o=a.rating===5?t.fiveStarReviews-1:t.fiveStarReviews;let d=t.averageRating,p=0,j=t.responseRate;if(n>0){const q=t.averageRating*t.totalReviews-a.rating;d=Number((q/n).toFixed(1)),p=Math.round(o/n*100);const ne=Math.round(t.totalReviews*t.responseRate/100)-(a.hasResponse?1:0);j=Math.round(ne/n*100)}return{...t,totalReviews:n,averageRating:d,fiveStarReviews:o,fiveStarPercentage:p,responseRate:j,ratingDistribution:{...t.ratingDistribution,[a.rating.toString()]:t.ratingDistribution[a.rating.toString()]-1}}}),U(t=>{if(!t)return t;const a=t.total-1,n=Math.ceil(a/t.limit)||1;return{...t,total:a,totalPages:n}}),h({title:"Success",description:"Review deleted successfully"}),f(t=>({...t,open:!1,isLoading:!1}))}catch(t){const a=(s=t.response)==null?void 0:s.status;h({title:"Error",description:a===400?"Review ID is required":a===401?"Authentication failed":a===404?"Review not found":a===500?"Internal server error":"Failed to delete review",variant:"destructive"}),f(n=>({...n,isLoading:!1}))}},ee=async()=>{var s;f(t=>({...t,isLoading:!0}));try{await k.delete("/adminDeleteResponse",{params:{responseId:m.id}}),P(t=>t.map(a=>{var n;return((n=a.response)==null?void 0:n.id)===m.id?{...a,hasResponse:!1,response:null}:a})),T(t=>{if(!t)return t;const a=Math.round(t.totalReviews*t.responseRate/100)-1,n=t.totalReviews>0?Math.round(a/t.totalReviews*100):0;return{...t,responseRate:n}}),h({title:"Success",description:"Response deleted successfully"}),f(t=>({...t,open:!1,isLoading:!1}))}catch(t){const a=(s=t.response)==null?void 0:s.status;h({title:"Error",description:a===400?"Response ID required":a===401?"Authentication failed":a===404?"Response not found":a===500?"Internal server error":"Failed to delete response",variant:"destructive"}),f(n=>({...n,isLoading:!1}))}},B=s=>s.trim()?s.length>2e3?"Response must be 1-2000 characters":null:"Response is required",se=async s=>{var a;const t=B(N);if(t){h({title:"Validation Error",description:t,variant:"destructive"});return}F(n=>({...n,respond:{...n.respond,[s]:!0}}));try{const n=await k.post("/adminRespondToReview",{response:N},{params:{reviewId:s}});if(n.data.success){const o=n.data.data;P(d=>d.map(p=>p.id===s?{...p,hasResponse:!0,response:o}:p)),T(d=>{if(!d)return d;const p=Math.round((d.totalReviews*d.responseRate/100+1)/d.totalReviews*100);return{...d,responseRate:p}})}h({title:"Success",description:"Response added successfully"}),M(null),L("")}catch(n){const o=(a=n.response)==null?void 0:a.status;h({title:"Error",description:o===400?"Validation error or Review ID required":o===401?"Authentication failed":o===404?"Review not found":o===409?"Response already exists for this review":o===500?"Internal server error":"Failed to add response",variant:"destructive"})}finally{F(n=>({...n,respond:{...n.respond,[s]:!1}}))}},te=async(s,t)=>{var n;const a=B(N);if(a){h({title:"Validation Error",description:a,variant:"destructive"});return}F(o=>({...o,updateResponse:{...o.updateResponse,[t]:!0}}));try{const o=await k.put("/adminUpdateResponse",{response:N},{params:{responseId:s}});if(o.data.success){const d=o.data.data;P(p=>p.map(j=>j.id===t&&j.response?{...j,response:{...j.response,response:d.response,updatedAt:d.updatedAt}}:j))}h({title:"Success",description:"Response updated successfully"}),I(null),L("")}catch(o){const d=(n=o.response)==null?void 0:n.status;h({title:"Error",description:d===400?"Validation error or Response ID required":d===401?"Authentication failed":d===404?"Response not found":d===500?"Internal server error":"Failed to update response",variant:"destructive"})}finally{F(o=>({...o,updateResponse:{...o.updateResponse,[t]:!1}}))}},O=s=>Array.from({length:5},(t,a)=>e.jsx(_,{className:`h-4 w-4 ${a<s?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},a)),X=s=>typeof s=="string"?new Date(s).toLocaleDateString():new Date(s._seconds*1e3+s._nanoseconds/1e6).toLocaleDateString(),ae=()=>{m.type==="review"?Y():ee()};return e.jsx(oe,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Reviews"}),e.jsx("p",{className:"text-muted-foreground",children:"Customer feedback and ratings for your services"})]}),e.jsxs("div",{className:"grid gap-4 grid-cols-1 md:grid-cols-3 lg:grid-cols-5",children:[e.jsxs(w,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"Average Rating"}),e.jsx(_,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(D,{children:A?e.jsxs(e.Fragment,{children:[e.jsx(c,{className:"h-8 w-16"}),e.jsx("div",{className:"flex items-center mt-1 space-x-1",children:Array.from({length:5}).map((s,t)=>e.jsx(c,{className:"h-4 w-4 rounded-full"},t))})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-2xl font-bold",children:r==null?void 0:r.averageRating.toFixed(1)}),e.jsx("div",{className:"flex items-center mt-1",children:O(Math.round((r==null?void 0:r.averageRating)||0))})]})})]}),e.jsxs(w,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"Total Reviews"}),e.jsx(be,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(D,{children:A?e.jsxs(e.Fragment,{children:[e.jsx(c,{className:"h-8 w-16"}),e.jsx(c,{className:"h-3 w-24 mt-2"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-2xl font-bold",children:r==null?void 0:r.totalReviews}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r==null?void 0:r.changeFromLastMonth})]})})]}),e.jsxs(w,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"5-Star Reviews"}),e.jsx(Ae,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(D,{children:A?e.jsxs(e.Fragment,{children:[e.jsx(c,{className:"h-8 w-16"}),e.jsx(c,{className:"h-3 w-24 mt-2"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-2xl font-bold",children:r==null?void 0:r.fiveStarReviews}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r==null?void 0:r.fiveStarPercentage,"% of total"]})]})})]}),e.jsxs(w,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"Response Rate"}),e.jsx(ye,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(D,{children:A?e.jsxs(e.Fragment,{children:[e.jsx(c,{className:"h-8 w-16"}),e.jsx(c,{className:"h-3 w-32 mt-2"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[r==null?void 0:r.responseRate,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Reviews responded to"})]})})]}),e.jsxs(w,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"Rating Distribution"}),e.jsx(_,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(D,{children:A?e.jsx("div",{className:"space-y-1",children:Array.from({length:5}).map((s,t)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(c,{className:"h-2 w-4"}),e.jsx(c,{className:"h-2 flex-1"}),e.jsx(c,{className:"h-2 w-4"})]},t))}):e.jsx("div",{className:"space-y-1",children:[5,4,3,2,1].map(s=>{const t=(r==null?void 0:r.ratingDistribution[s.toString()])||0,a=r!=null&&r.totalReviews?Math.round(t/r.totalReviews*100):0;return e.jsxs("div",{className:"flex items-center space-x-1 text-xs",children:[e.jsxs("span",{className:"w-4 text-xs",children:[s,"★"]}),e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-1.5 overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-300 ${s===5?"bg-green-500":s===4?"bg-green-400":s===3?"bg-yellow-500":s===2?"bg-orange-500":"bg-red-500"}`,style:{width:`${a}%`}})}),e.jsx("span",{className:"w-4 text-xs text-muted-foreground",children:t})]},s)})})})]})]}),e.jsxs(w,{children:[e.jsx(b,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(y,{children:"Recent Reviews"}),e.jsx(le,{children:"Latest customer feedback and ratings"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Show:"}),e.jsxs("select",{value:C,onChange:s=>{K(Number(s.target.value)),v(1)},className:"px-3 py-1 border border-input rounded-md text-sm bg-background focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent",disabled:S,children:[e.jsx("option",{value:5,children:"5 reviews"}),e.jsx("option",{value:10,children:"10 reviews"}),e.jsx("option",{value:15,children:"15 reviews"}),e.jsx("option",{value:20,children:"20 reviews"})]})]})]})}),e.jsx(D,{children:S?e.jsx("div",{className:"space-y-6",children:Array.from({length:3}).map((s,t)=>e.jsx("div",{className:"border-b pb-4 last:border-b-0",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx(c,{className:"h-10 w-10 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{className:"h-4 w-32"}),e.jsx(c,{className:"h-3 w-48"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(c,{className:"h-6 w-16"}),e.jsx(c,{className:"h-8 w-8"})]})]}),e.jsx("div",{className:"flex items-center space-x-1",children:Array.from({length:5}).map((a,n)=>e.jsx(c,{className:"h-4 w-4 rounded-full"},n))}),e.jsx(c,{className:"h-4 w-64"}),e.jsx(c,{className:"h-8 w-20"})]})]})},t))}):e.jsx("div",{className:"space-y-6",children:H.map(s=>{var t;return e.jsx("div",{className:"border-b pb-4 last:border-b-0",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx(ce,{children:e.jsx(xe,{children:s.customerInitials})}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:s.customerName}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Order: ",s.orderId]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:s.serviceNames.join(", ")}),e.jsx("span",{children:"•"}),e.jsx("span",{children:X(s.createdAt)})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(de,{variant:"outline",children:[s.rating," ⭐"]}),e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>z("review",s.id),children:e.jsx(Z,{className:"h-4 w-4 text-red-500"})})]})]}),e.jsx("div",{className:"flex items-center space-x-1",children:O(s.rating)}),e.jsx("p",{className:"text-sm",children:s.comment}),s.response?e.jsxs("div",{className:"mt-4 p-4 bg-muted rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h5",{className:"font-semibold",children:[s.response.adminName," responded:"]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>{I(s.response.id),L(s.response.response)},disabled:u.updateResponse[s.id],children:e.jsx(De,{className:"h-4 w-4"})}),e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>z("response",s.response.id,s.id),children:e.jsx(Z,{className:"h-4 w-4 text-red-500"})})]})]}),e.jsx("p",{className:"text-sm",children:s.response.response}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:X(s.response.updatedAt||s.response.createdAt)})]}):e.jsx(g,{variant:"outline",onClick:()=>M(s.id),disabled:u.respond[s.id],children:"Respond"}),(Q===s.id||E===((t=s.response)==null?void 0:t.id))&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx(me,{placeholder:"Enter your response...",value:N,onChange:a=>L(a.target.value),maxLength:2e3,disabled:u.respond[s.id]||u.updateResponse[s.id]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(g,{onClick:()=>E?te(E,s.id):se(s.id),disabled:u.respond[s.id]||u.updateResponse[s.id],children:u.respond[s.id]||u.updateResponse[s.id]?"Saving...":e.jsxs(e.Fragment,{children:["Save ",e.jsx(Pe,{className:"ml-2 h-4 w-4"})]})}),e.jsxs(g,{variant:"outline",onClick:()=>{M(null),I(null),L("")},disabled:u.respond[s.id]||u.updateResponse[s.id],children:["Cancel ",e.jsx(ie,{className:"ml-2 h-4 w-4"})]})]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[N.length,"/2000 characters"]})]})]})]})]})},s.id)})})})]}),!S&&i&&i.totalPages>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",(l-1)*C+1," to ",Math.min(l*C,i.total)," of ",i.total," reviews"]}),e.jsx(Re,{children:e.jsxs(ve,{children:[e.jsx(R,{children:e.jsx(Ne,{onClick:s=>{s.preventDefault(),l>1&&v(l-1)},className:`cursor-pointer ${l===1?"pointer-events-none opacity-50":"hover:bg-accent"}`})}),i.totalPages>1&&e.jsx(R,{children:e.jsx(V,{onClick:s=>{s.preventDefault(),v(1)},isActive:l===1,className:"cursor-pointer hover:bg-accent",children:"1"})}),l>3&&i.totalPages>5&&e.jsx(R,{children:e.jsx("span",{className:"px-3 py-2 text-sm",children:"..."})}),Array.from({length:i.totalPages},(s,t)=>t+1).filter(s=>i.totalPages<=5?s>1&&s<i.totalPages:l<=3?s>1&&s<=4&&s<i.totalPages:l>=i.totalPages-2?s>=i.totalPages-3&&s<i.totalPages:s>=l-1&&s<=l+1).map(s=>e.jsx(R,{children:e.jsx(V,{onClick:t=>{t.preventDefault(),v(s)},isActive:l===s,className:"cursor-pointer hover:bg-accent",children:s})},s)),l<i.totalPages-2&&i.totalPages>5&&e.jsx(R,{children:e.jsx("span",{className:"px-3 py-2 text-sm",children:"..."})}),i.totalPages>1&&e.jsx(R,{children:e.jsx(V,{onClick:s=>{s.preventDefault(),v(i.totalPages)},isActive:l===i.totalPages,className:"cursor-pointer hover:bg-accent",children:i.totalPages})}),e.jsx(R,{children:e.jsx(we,{onClick:s=>{s.preventDefault(),l<i.totalPages&&v(l+1)},className:`cursor-pointer ${l===i.totalPages?"pointer-events-none opacity-50":"hover:bg-accent"}`})})]})})]}),e.jsx(he,{open:m.open,onOpenChange:s=>f(t=>({...t,open:s})),children:e.jsxs(ue,{children:[e.jsxs(pe,{children:[e.jsx(fe,{children:m.title}),e.jsx(je,{children:m.description})]}),e.jsxs(ge,{children:[e.jsx(g,{variant:"outline",onClick:()=>f(s=>({...s,open:!1})),disabled:m.isLoading,children:"Cancel"}),e.jsx(g,{variant:"destructive",onClick:ae,disabled:m.isLoading,children:m.isLoading?"Deleting...":"Delete"})]})]})})]})})};export{Oe as default};
