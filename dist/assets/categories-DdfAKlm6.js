import{c as le,j as e,r as g,o as de,u as me,q as ge,b as I,A as C}from"./index-ByY07t5U.js";import{P as he,D as pe}from"./DashboardLayout-CorAQK4x.js";import{T as ue,D,a as _,b as T,c as L,e as xe}from"./dialog-DND4cV_M.js";import{T as fe,B as je}from"./breadcrumb-7WFJLWKT.js";import{C as Y,a as ye,b as ve,c as W}from"./card-DrHBsbjm.js";import{B as v}from"./button-DBciqQcI.js";import{S as be}from"./square-pen-BFr-I4KV.js";import{C as Ne}from"./calendar-DaBMcz2l.js";import{z as w,u as Ce,t as we}from"./index-pvnq_pFp.js";import{F as Se,a as V,b as B,c as $,d as G,f as q,e as z}from"./form-D1pnXXWo.js";import{I as Ie}from"./input-DcxO3ESS.js";import{S as Ee,a as ke,b as Ae,c as Fe,d as De}from"./select-DSUhFaX8.js";import{L as U}from"./loader-circle-CHQfb1Hg.js";import{P as _e}from"./plus-DsKVMYgt.js";import"./index-Dxwkp90n.js";import"./Combination-DHf6tu9R.js";import"./chevron-right-Nhb4I_UE.js";import"./label-CtRxIZG0.js";import"./index-DjrpyVfh.js";import"./index-DDlNMbpf.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=le("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);function b(s){return"categoryId"in s}const Le=s=>s?new Date(s._seconds*1e3+s._nanoseconds/1e6):new Date,Z=s=>b(s)?s.categoryName:s.name,A=s=>b(s)?s.categoryId:s.id,Me=(s,r)=>b(s)?r.find(i=>i.name===s.serviceName):r.find(i=>i.id===s.serviceId);function Pe({category:s,service:r,onEdit:i,onDelete:n,onClick:p}){const l=b(s)?!0:!s.isDeleted,d=(r==null?void 0:r.pricingModel)==="per_item",c=(r==null?void 0:r.name)||"Unknown Service",j=(r==null?void 0:r.pricingModel)||"unknown";return e.jsxs(Y,{className:"group relative overflow-hidden border border-gray-200 shadow-md hover:shadow-xl transition-all duration-300 cursor-pointer bg-white hover:bg-gray-50/50 transform hover:-translate-y-1 hover:scale-[1.02]",onClick:p,children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-purple-500 to-indigo-600"}),e.jsx(ye,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-gradient-to-br from-purple-100 to-indigo-100 group-hover:from-purple-200 group-hover:to-indigo-200 transition-colors shadow-sm",children:e.jsx(fe,{className:"h-5 w-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx(ve,{className:"text-lg font-semibold text-gray-900 group-hover:text-purple-900 transition-colors line-clamp-1",children:Z(s)}),e.jsx("div",{className:"flex items-center mt-1",children:e.jsxs("span",{className:`inline-flex items-center px-2 py-1 text-xs font-medium rounded-full ${l?"bg-green-100 text-green-800 border border-green-200":"bg-gray-100 text-gray-600 border border-gray-200"}`,children:[e.jsx("div",{className:`w-1.5 h-1.5 rounded-full mr-1 ${l?"bg-green-500":"bg-gray-400"}`}),l?"Active":"Inactive"]})})]})]}),e.jsxs("div",{className:"flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity",onClick:f=>f.stopPropagation(),children:[d&&e.jsx(v,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-purple-100 hover:text-purple-700",onClick:i,children:e.jsx(be,{className:"h-3.5 w-3.5"})}),e.jsx(v,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-red-100 hover:text-red-700",onClick:n,children:e.jsx(ue,{className:"h-3.5 w-3.5"})})]})]})}),e.jsx(W,{className:"pt-0",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 p-3 rounded-lg bg-gradient-to-r from-gray-50 to-purple-50/30 border border-gray-100 shadow-sm",children:[e.jsx(Te,{className:"h-4 w-4 text-gray-600"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:c}),e.jsxs("p",{className:"text-xs text-gray-500 capitalize",children:[j.replace("_"," ")," pricing"]})]})]}),!b(s)&&s.createdAt&&e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-gray-500",children:[e.jsx(Ne,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:["Created ",Le(s.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-gray-100",children:[e.jsx("span",{className:"text-xs text-gray-400",children:"Click to view products"}),e.jsx("div",{className:"text-purple-600 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})]})})]})}function Oe({categories:s,services:r,isLoading:i,serviceId:n,onEdit:p,onDelete:l,onClick:d}){return i?e.jsx(Re,{}):s.length===0?e.jsx(Y,{children:e.jsxs(W,{className:"flex flex-col items-center justify-center py-16",children:[e.jsx("div",{className:"rounded-full bg-gradient-to-br from-purple-100 to-indigo-100 p-6 mb-6 shadow-lg",children:e.jsx(he,{className:"h-12 w-12 text-purple-600"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No categories found"}),e.jsx("p",{className:"text-gray-500 text-center max-w-md mb-6",children:n?"This service doesn't have any categories yet. Create your first category to get started.":"No categories have been created yet across all services."})]})}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:s.map(c=>{const j=Me(c,r);return e.jsx(Pe,{category:c,service:j,onEdit:f=>p(c,f),onDelete:f=>l(c,f),onClick:()=>d(c)},A(c))})})}function Re(){return e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[...Array(3)].map((s,r)=>e.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"h-1 bg-gray-200 animate-pulse"}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"h-10 w-10 bg-gray-200 rounded-lg animate-pulse"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-5 w-32 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-4 w-16 bg-gray-200 rounded-full animate-pulse"})]})]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"h-8 w-8 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-8 w-8 bg-gray-200 rounded animate-pulse"})]})]}),e.jsx("div",{className:"p-3 rounded-lg bg-gray-200 animate-pulse",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"h-4 w-4 bg-gray-300 rounded animate-pulse"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 w-24 bg-gray-300 rounded animate-pulse"}),e.jsx("div",{className:"h-3 w-16 bg-gray-300 rounded animate-pulse"})]})]})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"h-3.5 w-3.5 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-3 w-20 bg-gray-200 rounded animate-pulse"})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-gray-100",children:[e.jsx("div",{className:"h-3 w-24 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-4 w-4 bg-gray-200 rounded animate-pulse"})]})]})]},r))})}const J=w.object({name:w.string().min(2,{message:"Name must be at least 2 characters."}),description:w.string().optional(),serviceId:w.string().optional()}),Ve=J.extend({serviceId:w.string().min(1,{message:"Please select a service."})}),Be=J.extend({serviceId:w.string().optional()});function H({onSubmit:s,onCancel:r,initialData:i,services:n,isSubmitting:p=!1}){const[l,d]=g.useState(!1),[c,j]=g.useState(null),f=n&&n.length>0?Ve:Be,x=Ce({resolver:we(f),defaultValues:{name:(i==null?void 0:i.name)||"",description:"",serviceId:(i==null?void 0:i.serviceId)||(n&&n.length>0?n[0].id:"")}});g.useEffect(()=>{if(i&&!c){const m={name:i.name||"",description:"",serviceId:i.serviceId||(n&&n.length>0?n[0].id:"")};j(m)}},[i,c,n]),g.useEffect(()=>{if(c){const m=x.getValues(),h=m.name!==c.name||m.serviceId!==c.serviceId;d(h)}},[x.watch(),c]);const E=async m=>{await s({name:m.name,serviceId:m.serviceId})},u=p||!x.formState.isValid||!l;return e.jsx(Se,{...x,children:e.jsxs("form",{onSubmit:x.handleSubmit(E),className:"space-y-6",children:[e.jsx(V,{control:x.control,name:"name",render:({field:m})=>e.jsxs(B,{children:[e.jsx($,{children:"Category Name"}),e.jsx(G,{children:e.jsx(Ie,{placeholder:"Enter category name",...m})}),e.jsx(q,{children:"This is the name that will be displayed to users."}),e.jsx(z,{})]})}),n&&n.length>0&&e.jsx(V,{control:x.control,name:"serviceId",render:({field:m})=>e.jsxs(B,{children:[e.jsx($,{children:"Service"}),e.jsxs(Ee,{onValueChange:m.onChange,value:m.value,children:[e.jsx(G,{children:e.jsx(ke,{children:e.jsx(Ae,{placeholder:"Select a service"})})}),e.jsx(Fe,{children:n.map(h=>e.jsx(De,{value:h.id,children:h.name},h.id))})]}),e.jsx(q,{children:"Select the service associated with this category."}),e.jsx(z,{})]})}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(v,{variant:"outline",type:"button",onClick:r,disabled:p,children:"Cancel"}),e.jsx(v,{type:"submit",disabled:u,children:p?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Save Category"})]})]})})}function $e({serviceId:s,services:r,isLoading:i,canAddCategories:n,onAddCategory:p}){var l;return e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:s?i||r.length===0?e.jsx("span",{className:"inline-block h-8 w-48 bg-gray-200 rounded animate-pulse"}):`Categories for ${((l=r.find(d=>d.id===s))==null?void 0:l.name)||"Service"}`:"All Categories"}),e.jsx("p",{className:"text-muted-foreground",children:"Welcome to the Category Page, where you can create and manage categories."})]}),n&&e.jsxs(v,{className:"flex items-center gap-2",onClick:p,children:[e.jsx(_e,{className:"h-4 w-4"}),"Add Category"]})]})}function Ge(){var O;const{serviceId:s}=de(),r=me(),[i,n]=g.useState(!1),[p,l]=g.useState(!1),[d,c]=g.useState(null),[j,f]=g.useState([]),[x,E]=g.useState(!0),[u,m]=g.useState([]),{toast:h}=ge(),[y,N]=g.useState({open:!1,categoryId:null,deleting:!1}),[K,M]=g.useState(!1),[Q,P]=g.useState(!1),k=async()=>{var a;try{const t=s?`${C.GET_ALL_CATEGORIES_BY_SERVICE_ID()}?serviceId=${s}`:`${C.GET_ALL_CATEGORIES_BY_SERVICE_NAMES()}`,o=await I.get(t);f(((a=o.data)==null?void 0:a.data)||[])}catch(t){S(t,"Failed to fetch categories")}};g.useEffect(()=>{(async()=>{var t;E(!0);try{const o=await I.get(C.GET_ALL_SERVICES());m(((t=o.data)==null?void 0:t.data)||[]),await k()}catch(o){S(o,"Failed to fetch data")}finally{E(!1)}})()},[s]);const S=(a,t)=>{console.error(t,a),h({variant:"destructive",title:"Error",description:a instanceof Error?a.message:t})},X=a=>{var t;if(s)r(`/config/products/${A(a)}`,{state:{idType:"category"}});else{const o=b(a)?(t=u.find(F=>F.name===a.serviceName))==null?void 0:t.id:a.serviceId;o&&r(`/config/categories/${o}`)}},ee=a=>{if(!a)return u.some(o=>o.pricingModel==="per_item");const t=u.find(o=>o.id===a);return(t==null?void 0:t.pricingModel)==="per_item"},se=async a=>{try{M(!0);const t=s||a.serviceId;if(!t){h({variant:"destructive",title:"Error",description:"Service ID is required"});return}const o=u.find(ce=>ce.id===t);if((o==null?void 0:o.pricingModel)!=="per_item"){h({variant:"destructive",title:"Error",description:"Categories can only be created for services with per-item pricing"});return}const F={name:a.name,serviceId:t},R=await I.post(C.CREATE_CATEGORY(),F);if(!R.data.success)throw new Error(R.data.message||"Failed to create category");await k(),h({title:"Success",description:"Category created successfully"}),n(!1)}catch(t){S(t,"Failed to create category")}finally{M(!1)}},ae=async(a,t)=>{try{P(!0);const o=await I.put(C.UPDATE_CATEGORY(),{name:t.name},{params:{categoryId:a}});if(!o.data.success)throw new Error(o.data.message||"Failed to update category");await k(),h({title:"Success",description:"Category updated successfully"}),l(!1)}catch(o){S(o,"Failed to update category")}finally{P(!1)}},te=async a=>{try{const t=await I.delete(C.DELETE_CATEGORY(),{params:{categoryId:a}});if(!t.data.success)throw new Error(t.data.message||"Failed to delete category");await k(),h({title:"Success",description:"Category deleted successfully"})}catch(t){S(t,"Failed to delete category")}},re=(a,t)=>{t.stopPropagation(),c(a),l(!0)},ne=(a,t)=>{t.stopPropagation(),N({open:!0,categoryId:A(a),deleting:!1})},ie=async()=>{if(y.categoryId){N(a=>({...a,deleting:!0}));try{await te(y.categoryId),N({open:!1,categoryId:null,deleting:!1})}catch{N(t=>({...t,deleting:!1}))}}},oe=[{label:"Services",to:"/config/services"},{label:"Categories",to:s?`/config/categories/${s}`:"/config/categories"}];return e.jsxs("div",{className:"space-y-4",children:[e.jsx(je,{items:oe}),e.jsx($e,{serviceId:s,services:u,isLoading:x,canAddCategories:ee(s),onAddCategory:()=>n(!0)}),e.jsx(Oe,{categories:j,services:u,isLoading:x,serviceId:s,onEdit:re,onDelete:ne,onClick:X}),e.jsx(D,{open:i,onOpenChange:n,children:e.jsxs(_,{className:"sm:max-w-[525px]",children:[e.jsx(T,{children:e.jsx(L,{children:"Create New Category"})}),e.jsx(H,{onSubmit:se,onCancel:()=>n(!1),services:s?void 0:u.filter(a=>a.pricingModel==="per_item"),initialData:s?{serviceId:s}:void 0,isSubmitting:K})]})}),e.jsx(D,{open:p,onOpenChange:l,children:e.jsxs(_,{className:"sm:max-w-[525px]",children:[e.jsx(T,{children:e.jsx(L,{children:"Edit Category"})}),d&&e.jsx(H,{onSubmit:async a=>{await ae(A(d),{name:a.name})},onCancel:()=>l(!1),initialData:{name:Z(d),serviceId:b(d)?(O=u.find(a=>a.name===d.serviceName))==null?void 0:O.id:d.serviceId},services:s?void 0:u.filter(a=>a.pricingModel==="per_item"),isSubmitting:Q})]})}),e.jsx(D,{open:y.open,onOpenChange:a=>{y.deleting||N({open:a,categoryId:null,deleting:!1})},children:e.jsxs(_,{className:"sm:max-w-md",children:[e.jsxs(T,{children:[e.jsx(L,{children:"Confirm Delete"}),e.jsx(xe,{children:"Are you sure you want to delete this category? This action cannot be undone."})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(v,{variant:"outline",onClick:()=>N({open:!1,categoryId:null,deleting:!1}),disabled:y.deleting,children:"Cancel"}),e.jsx(v,{variant:"destructive",onClick:ie,disabled:y.deleting,children:y.deleting?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"mr-2 h-4 w-4 animate-spin"}),"Deleting..."]}):"Delete"})]})]})})]})}function ls(){return e.jsx(pe,{children:e.jsx("div",{className:"space-y-4",children:e.jsx(Ge,{})})})}export{ls as default};
