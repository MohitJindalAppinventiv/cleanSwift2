import{u as O,q as M,r as o,j as e,X as q}from"./index-ByY07t5U.js";import{B as m}from"./button-DBciqQcI.js";import{I as D}from"./input-DcxO3ESS.js";import{T as z}from"./textarea-CMzAX9ph.js";import{F as J,a as d,b as p,c as g,d as h,e as N}from"./form-D1pnXXWo.js";import{o as H,s as U,b as W,u as X,t as Y}from"./index-pvnq_pFp.js";import{F as $,U as K}from"./upload-Dz_LuVq4.js";const Q=H({title:U().min(3,{message:"Title must be at least 3 characters"}).max(50),description:U().min(10,{message:"Description must be at least 10 characters"}).max(200),imageUrl:U().min(1,{message:"Image is required"}),isActive:W().default(!0)});function te({onSave:w,isSubmitting:x=!1,defaultValues:a,isEdit:n=!1}){const C=O(),{toast:c}=M(),[j,v]=o.useState((a==null?void 0:a.imageUrl)||""),[T,f]=o.useState(!1),[l,b]=o.useState(!1),[k,A]=o.useState(!1),[i,P]=o.useState(null),t=X({resolver:Y(Q),defaultValues:{title:(a==null?void 0:a.title)||"",description:(a==null?void 0:a.description)||"",imageUrl:(a==null?void 0:a.imageUrl)||"",isActive:(a==null?void 0:a.isActive)??!0},mode:"onChange",reValidateMode:"onChange"});o.useEffect(()=>{if(n&&a&&!i){const r={title:a.title||"",description:a.description||"",imageUrl:a.imageUrl||"",isActive:a.isActive??!0};P(r)}},[n,a,i]),o.useEffect(()=>{if(n&&i){const r=t.getValues(),s=r.title!==i.title||r.description!==i.description||r.imageUrl!==i.imageUrl||r.isActive!==i.isActive;A(s)}},[t.watch(),n,i]);const S=r=>{v(r),t.setValue("imageUrl",r,{shouldValidate:!0}),b(!1)},F=r=>{if(!["image/png","image/jpeg","image/jpg"].includes(r.type)){c({title:"Invalid file type",description:"Please upload a PNG or JPG image file",variant:"destructive"});return}const u=new FileReader;u.onloadend=()=>{const I=u.result;v(I),t.setValue("imageUrl",I,{shouldValidate:!0}),b(!0),c({title:"Image selected",description:"Your image has been prepared for upload"})},u.readAsDataURL(r)},B=r=>{r.preventDefault(),f(!0)},E=()=>{f(!1)},L=r=>{if(r.preventDefault(),f(!1),r.dataTransfer.files&&r.dataTransfer.files.length>0){const s=r.dataTransfer.files[0];s.type.startsWith("image/")?F(s):c({title:"Invalid file type",description:"Please upload an image file (JPEG, PNG, etc.)",variant:"destructive"})}},y=()=>{v(""),t.setValue("imageUrl","",{shouldValidate:!0}),b(!1)},R=r=>{try{const s={title:r.title,description:r.description,imageUrl:r.imageUrl,isActive:r.isActive};w(s)}catch{c({title:"Error",description:"Failed to save banner",variant:"destructive"})}},G=x||!t.formState.isValid||n&&!k;return e.jsx(J,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(R),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx(d,{control:t.control,name:"title",render:({field:r})=>e.jsxs(p,{children:[e.jsx(g,{children:"Title"}),e.jsx(h,{children:e.jsx(D,{placeholder:"Enter banner title",...r})}),e.jsx(N,{})]})}),e.jsx(d,{control:t.control,name:"description",render:({field:r})=>e.jsxs(p,{children:[e.jsx(g,{children:"Description"}),e.jsx(h,{children:e.jsx(z,{placeholder:"Enter banner description",className:"min-h-[120px]",...r})}),e.jsx(N,{})]})}),e.jsx(d,{control:t.control,name:"imageUrl",render:({field:r})=>e.jsxs(p,{children:[e.jsxs(g,{children:["Image ",l?"File":"URL"]}),e.jsx(h,{children:e.jsx(D,{placeholder:l?"Image file selected":"https://example.com/image.jpg",...r,onChange:s=>!l&&S(s.target.value),disabled:l||n})}),e.jsx(N,{})]})}),e.jsx(d,{control:t.control,name:"isActive",render:({field:r})=>e.jsxs(p,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4",children:[e.jsx(h,{children:e.jsx("input",{type:"checkbox",checked:r.value,onChange:r.onChange,className:"h-4 w-4 rounded border-gray-300 text-primary focus:ring-2 focus:ring-primary"})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(g,{children:"Active"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Make this banner visible in the app"})]})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-sm font-medium",children:"Image Preview"}),e.jsxs("div",{className:"relative aspect-[16/9] overflow-hidden rounded-md border bg-gray-50",children:[j?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"relative h-full w-full",children:[e.jsx("img",{src:j,alt:"Banner preview",className:"h-full w-full object-cover",onError:()=>{y(),c({title:"Error loading image",description:"Please check the image and try again",variant:"destructive"})}}),e.jsx("button",{type:"button",className:"absolute top-2 right-2 p-1 rounded-full bg-gray-800/50 hover:bg-gray-800/75 text-white",onClick:r=>{r.stopPropagation(),y()},children:e.jsx(q,{className:"h-4 w-4"})})]})}):e.jsx("div",{className:`flex h-full flex-col items-center justify-center cursor-pointer ${T?"border-primary border-2":"border-dashed border-gray-300"}`,onDragOver:B,onDragLeave:E,onDrop:L,onClick:()=>{var r;return(r=document.getElementById("image-upload"))==null?void 0:r.click()},children:e.jsxs("div",{className:"text-center p-6 flex flex-col items-center gap-2",children:[e.jsx("div",{className:"bg-gray-100 rounded-full p-3",children:e.jsx($,{className:"h-6 w-6 text-gray-400"})}),e.jsx("p",{className:"text-sm font-medium",children:n?"Upload a new image":"Upload an image or enter a URL"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Drag and drop or click to browse"}),e.jsxs(m,{type:"button",variant:"outline",size:"sm",className:"mt-2",onClick:r=>{var s;r.stopPropagation(),(s=document.getElementById("image-upload"))==null||s.click()},children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),"Upload Image"]})]})}),e.jsx("input",{id:"image-upload",type:"file",accept:"image/*",className:"hidden",onChange:r=>{r.target.files&&r.target.files[0]&&F(r.target.files[0])}})]}),j&&e.jsx("div",{className:"flex justify-end",children:e.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:y,children:"Remove Image"})})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>C("/config/app-banner"),disabled:x,children:"Cancel"}),e.jsx(m,{type:"submit",disabled:G,children:x?"Saving...":"Save Banner"})]})]})})}export{te as B};
