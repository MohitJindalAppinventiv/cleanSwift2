import{i as K,r as a,q,u as J,j as e,b as k,A as M}from"./index-ByY07t5U.js";import{u as O,S as X,G as U,M as H}from"./esm-pF9UzyqD.js";import{I}from"./input-DcxO3ESS.js";import{L as c}from"./label-CtRxIZG0.js";import{B as z}from"./button-DBciqQcI.js";const Q={width:"100%",height:"400px"},V={lat:28.6139,lng:77.209},W=["places"];function ae(){const l=K(s=>s.profileStatus);console.log("profileComplete",l);const[i,u]=a.useState(""),[x,f]=a.useState(""),[t,j]=a.useState(V),[y,m]=a.useState(""),[g,F]=a.useState([]),v=a.useRef(null),N=a.useRef(null),{toast:b}=q(),S=J(),{isLoaded:p,loadError:G}=O({googleMapsApiKey:"AIzaSyCezEfXJkSCvz2n2qctuwR2T0bnDtLOg_k",libraries:W}),_=a.useCallback(s=>{if(s.latLng){const o=s.latLng.lat(),n=s.latLng.lng();j({lat:o,lng:n})}},[]),P=(s,o)=>{if(!window.google)return;new window.google.maps.Geocoder().geocode({location:{lat:s,lng:o}},(r,d)=>{d==="OK"&&r&&r.length>0?m(r[0].formatted_address):m("Unable to detect address")})};a.useEffect(()=>{p&&t.lat&&t.lng&&P(t.lat,t.lng)},[t,p]);const T=()=>{var o,n,r,d,w,L;const s=(o=N.current)==null?void 0:o.getPlaces();if(s&&s.length>0){const h=s[0],C=(r=(n=h.geometry)==null?void 0:n.location)==null?void 0:r.lat(),R=(w=(d=h.geometry)==null?void 0:d.location)==null?void 0:w.lng();if(C&&R){const E={lat:C,lng:R};j(E),(L=v.current)==null||L.panTo(E),m(h.formatted_address||"")}}},A=async()=>{try{const s=await k.get(M.GET_AREAS());F(s.data.areas||[])}catch(s){console.error("Failed to fetch areas",s)}};a.useEffect(()=>{A()},[]);const B=async()=>{try{await k.post(M.ADMIN_CREATE_AREA(),{locationName:i,coordinates:{latitude:t.lat,longitude:t.lng},range:Number(x),address:y}),b({title:"Location added to map!"}),u(""),f(""),await A()}catch(s){console.error("Add Error",s),b({variant:"destructive",title:"Failed to add location"})}},D=()=>{l.data.configurations.service.isConfigured?(console.log("location  ",l),S("/")):S("/Serv")};return G?e.jsx("div",{children:"Failed to load Google Maps"}):e.jsx("div",{className:"min-h-screen bg-gray-100 py-10 px-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto bg-white p-8 rounded-xl shadow-lg space-y-8",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Store Location Management"}),e.jsx("p",{className:"text-gray-600",children:"Add your store location on the map and define a service radius to serve customers."})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-700",children:"Add New Store"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"storeName",children:"Store Name"}),e.jsx(I,{id:"storeName",value:i,onChange:s=>u(s.target.value),placeholder:"Enter your store name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"serviceRadius",children:"Serviceable Radius (in KM)"}),e.jsx(I,{id:"serviceRadius",type:"number",value:x,onChange:s=>f(s.target.value),min:1,placeholder:"e.g., 5"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Detected Address"}),e.jsx("div",{className:"p-3 border rounded-md bg-gray-100 text-sm text-gray-700",children:y})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Choose Store Location"}),e.jsx("div",{className:"relative border border-gray-300 rounded-md overflow-hidden shadow-sm",children:p?e.jsxs(e.Fragment,{children:[e.jsx(X,{onLoad:s=>N.current=s,onPlacesChanged:T,children:e.jsx("input",{type:"text",placeholder:"Search location...",style:{position:"absolute",top:10,left:"50%",transform:"translateX(-50%)",width:"300px",padding:"8px 12px",borderRadius:"4px",zIndex:10,boxShadow:"0 2px 6px rgba(0,0,0,0.3)",border:"1px solid #ccc",fontSize:"14px"}})}),e.jsx(U,{mapContainerStyle:Q,center:t,zoom:14,onClick:_,onLoad:s=>v.current=s,children:e.jsx(H,{position:t})})]}):e.jsx("div",{className:"flex justify-center items-center h-[400px]",children:"Loading map..."})})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 pt-2",children:[e.jsx(z,{onClick:B,disabled:!i||!x,children:"Add Areas"}),e.jsx(z,{variant:"secondary",onClick:D,disabled:g.length===0,children:"Next"})]})]}),e.jsxs("div",{className:"pt-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-700 mb-4",children:"Saved Locations"}),g.length===0?e.jsx("p",{className:"text-gray-500",children:"No store locations added yet."}):e.jsx("div",{className:"grid gap-4",children:g.map(s=>e.jsxs("div",{className:"border p-4 rounded-md shadow-sm space-y-1 bg-gray-50",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:s.locationName}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Address: ",s.address]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Radius: ",s.range," km"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Lat: ",s.coordinates.latitude,", Lng:"," ",s.coordinates.longitude]})]},s.id))})]})]})})}export{ae as default};
